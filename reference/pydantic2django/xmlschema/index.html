
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Convert Pydantic models to Django models dynamically">
      
      
      
      
        <link rel="prev" href="../typedclass/generator/">
      
      
        <link rel="next" href="discovery/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.17">
    
    
      
        <title>pydantic2django.xmlschema - Pydantic2Django</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.7e37652d.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pydantic2django.xmlschema" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Pydantic2Django" class="md-header__button md-logo" aria-label="Pydantic2Django" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Pydantic2Django
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pydantic2django.xmlschema
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Pydantic2Django

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../Architecture/CONTEXT_HANDLING/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../bugs/2025-10-01-xml-wrapper-child-fk-direction/" class="md-tabs__link">
          
  
  
  Bugs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../how_it_works/core_modules_and_concepts/" class="md-tabs__link">
          
  
  
  How it works

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../how_to_use/bidirectional_generation/" class="md-tabs__link">
          
  
  
  How to use

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../plans/gfk_generic_entries_plan/" class="md-tabs__link">
          
  
  
  Plans

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  
  Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Pydantic2Django" class="md-nav__button md-logo" aria-label="Pydantic2Django" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Pydantic2Django
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic2Django
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Architecture/CONTEXT_HANDLING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Context Handling in Pydantic2Django
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Architecture/OVERVIEW/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OVERVIEW
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Comparisons
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Comparisons
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Architecture/comparisons/README_DJANGO_STORAGE_OPTIONS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic to Django Storage Approaches
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../Architecture/comparisons/README_PYDANTIC_DJANGO_METHODS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic to Django Method Integration Approaches
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Bugs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Bugs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../bugs/2025-10-01-xml-wrapper-child-fk-direction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XML Schema wrapper children incorrectly attached as parent-side FKs
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How it works
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            How it works
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/core_modules_and_concepts/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Core modules and concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/generic_entries_contenttypes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generic entries contenttypes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/ingestor_strict_and_contract/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingestor strict and contract
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/provider_backend_pattern/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Provider backend pattern
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/readme_bidirectional_mapper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic2Django Bidirectional Mapper Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/readme_context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic2Django Context Storage and Generated Context Classes
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/readme_ingestion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingestion Pattern Across Modules
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/readme_relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pydantic2Django Relationships Accessor Details
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/timescale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Timescale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/xmlschema_element_and_type_handling/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XML Schema Handling: Elements, Attributes, Types, Relationships
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_it_works/xmlschema_notes/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    XML Schema Notes: complexType Handling
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    How to use
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            How to use
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_to_use/bidirectional_generation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Bidirectional generation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_to_use/ingestor_validation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ingestor validation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_to_use/integrate_into_django_app/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Integrate into django app
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../how_to_use/parametrized_assert_tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parametrized Single-Assertion Tests for End-to-End Load/Process/Persist
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Plans
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Plans
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../plans/gfk_generic_entries_plan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Providerâ€‘agnostic GenericForeignKey (GFK) plan
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" checked>
        
          
          <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    pydantic2django
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../entrypoint/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.entrypoint
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_3" >
        
          
          <label class="md-nav__link" for="__nav_7_1_3" id="__nav_7_1_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.core
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_3">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.core
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/base_generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.base_generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/bidirectional_mapper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.bidirectional_mapper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/context/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.context
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/defs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.defs
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/factories/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.factories
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/filter_helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.filter_helpers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/imports/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.imports
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/mapping_units/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.mapping_units
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.relationships
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/serialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.serialization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.typing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_3_14" >
        
          
          <label class="md-nav__link" for="__nav_7_1_3_14" id="__nav_7_1_3_14_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.core.utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_3_14_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_3_14">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.core.utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/utils/naming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.utils.naming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/utils/relationships/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.utils.relationships
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/utils/strings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.utils.strings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../core/utils/timescale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.core.utils.timescale
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_4" >
        
          
          <label class="md-nav__link" for="__nav_7_1_4" id="__nav_7_1_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.dataclass
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_4">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.dataclass
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.dataclass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclass/discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.dataclass.discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclass/factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.dataclass.factory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dataclass/generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.dataclass.generator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_5" >
        
          
          <label class="md-nav__link" for="__nav_7_1_5" id="__nav_7_1_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.django
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_5">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.django
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/admin/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.admin
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/conversion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.conversion
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/typing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.typing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_5_6" >
        
          
          <label class="md-nav__link" for="__nav_7_1_5_6" id="__nav_7_1_5_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.django.timescale
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_5_6">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.django.timescale
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/timescale/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.timescale
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/timescale/bases/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.timescale.bases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/timescale/heuristics/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.timescale.heuristics
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_5_7" >
        
          
          <label class="md-nav__link" for="__nav_7_1_5_7" id="__nav_7_1_5_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.django.utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_5_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_5_7">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.django.utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/utils/naming/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.utils.naming
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../django/utils/serialization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.django.utils.serialization
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_6" >
        
          
          <label class="md-nav__link" for="__nav_7_1_6" id="__nav_7_1_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_6">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.pydantic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic.discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic.factory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic.generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_6_5" >
        
          
          <label class="md-nav__link" for="__nav_7_1_6_5" id="__nav_7_1_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic.utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_7_1_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_6_5">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.pydantic.utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/utils/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pydantic/utils/introspection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.pydantic.utils.introspection
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1_7" >
        
          
          <label class="md-nav__link" for="__nav_7_1_7" id="__nav_7_1_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.typedclass
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1_7">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.typedclass
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typedclass/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.typedclass
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typedclass/discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.typedclass.discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typedclass/factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.typedclass.factory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../typedclass/generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.typedclass.generator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1_8" checked>
        
          
          <label class="md-nav__link" for="__nav_7_1_8" id="__nav_7_1_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_7_1_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_1_8">
            <span class="md-nav__icon md-icon"></span>
            pydantic2django.xmlschema
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema" class="md-nav__link">
    <span class="md-ellipsis">
      xmlschema
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlInstanceIngestor" class="md-nav__link">
    <span class="md-ellipsis">
      XmlInstanceIngestor
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XmlInstanceIngestor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlInstanceIngestor.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlInstanceIngestor.ingest_from_file" class="md-nav__link">
    <span class="md-ellipsis">
      ingest_from_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlInstanceIngestor.ingest_from_string" class="md-nav__link">
    <span class="md-ellipsis">
      ingest_from_string
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlInstanceIngestor.validate_models" class="md-nav__link">
    <span class="md-ellipsis">
      validate_models
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator" class="md-nav__link">
    <span class="md-ellipsis">
      XmlSchemaDjangoModelGenerator
    </span>
  </a>
  
    <nav class="md-nav" aria-label="XmlSchemaDjangoModelGenerator">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.from_schema_files" class="md-nav__link">
    <span class="md-ellipsis">
      from_schema_files
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate" class="md-nav__link">
    <span class="md-ellipsis">
      generate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate_models_file" class="md-nav__link">
    <span class="md-ellipsis">
      generate_models_file
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate_models_with_xml_metadata" class="md-nav__link">
    <span class="md-ellipsis">
      generate_models_with_xml_metadata
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.get_schema_statistics" class="md-nav__link">
    <span class="md-ellipsis">
      get_schema_statistics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.validate_schemas" class="md-nav__link">
    <span class="md-ellipsis">
      validate_schemas
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.get_generated_model" class="md-nav__link">
    <span class="md-ellipsis">
      get_generated_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pydantic2django.xmlschema.register_generated_model" class="md-nav__link">
    <span class="md-ellipsis">
      register_generated_model
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema.discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="factory/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema.factory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="generator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema.generator
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="ingestor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema.ingestor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema.models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="parser/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    pydantic2django.xmlschema.parser
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>pydantic2django.xmlschema</h1>

<div class="doc doc-object doc-module">



<a id="pydantic2django.xmlschema"></a>
    <div class="doc doc-contents first">

        <p>Lightweight xmlschema package initializer.</p>
<p>Exports objects lazily to avoid importing Django-dependent code unless needed.</p>
<p>Also exposes a minimal in-memory registry for dynamically generated Django
model classes so that utilities like the XML ingestor can resolve model
classes even when the target app is not installed in Django's app registry.
This is especially useful for unsaved instance workflows in tests.</p>









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="pydantic2django.xmlschema.XmlInstanceIngestor" class="doc doc-heading">
            <code>XmlInstanceIngestor</code>


<a href="#pydantic2django.xmlschema.XmlInstanceIngestor" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">


        <p>Schema-aware ingestor for XML instance documents.</p>
<p>Given XSD schema files and an app_label where models were generated,
this ingestor parses an XML instance and creates the corresponding Django
model instances, wiring up relationships according to generation strategy.</p>







              <details class="quote">
                <summary>Source code in <code>src/pydantic2django/xmlschema/ingestor.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">XmlInstanceIngestor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Schema-aware ingestor for XML instance documents.</span>

<span class="sd">    Given XSD schema files and an app_label where models were generated,</span>
<span class="sd">    this ingestor parses an XML instance and creates the corresponding Django</span>
<span class="sd">    model instances, wiring up relationships according to generation strategy.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">schema_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">dynamic_model_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize a schema-aware XML ingestor.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema_files: Paths to XSD files used to parse/resolve types.</span>
<span class="sd">            app_label: Django app label expected to contain installed models.</span>
<span class="sd">            dynamic_model_fallback: Controls behavior when an installed model is missing.</span>
<span class="sd">                - True: fall back to dynamically generated stand-ins from the</span>
<span class="sd">                  in-memory registry, allowing unsaved/ephemeral workflows.</span>
<span class="sd">                - False (default): raise ModelResolutionError when a discovered complex type cannot be</span>
<span class="sd">                  resolved to an installed Django model, avoiding implicit usage of stand-ins.</span>

<span class="sd">        Behavior:</span>
<span class="sd">            - Regardless of the fallback flag, the ingestor will always prefer installed Django</span>
<span class="sd">              models and pre-cache them for all discovered complex types to ensure consistent</span>
<span class="sd">              resolution across root and nested elements.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>  <span class="c1"># Validate dependency early</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span>  <span class="c1"># noqa: F401</span>
        <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - environment dependent</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;lxml is required for XML ingestion. Install with: pip install lxml&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span> <span class="o">=</span> <span class="n">app_label</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_model_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">dynamic_model_fallback</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">strict</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">discovery</span> <span class="o">=</span> <span class="n">XmlSchemaDiscovery</span><span class="p">()</span>
        <span class="n">discovery</span><span class="o">.</span><span class="n">discover_models</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">schema_files</span><span class="p">],</span> <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">)</span>
        <span class="c1"># Keep references for mapping</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">XmlSchemaDefinition</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">discovery</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">)</span>

        <span class="c1"># Pre-resolve and cache installed Django model classes for all discovered complex types.</span>
        <span class="c1"># This guarantees we consistently use concrete models (with managers) when available.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">discovered_names</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">():</span>
                    <span class="n">discovered_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">discovered_names</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model_cls</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">model_cls</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">model_cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cls</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Cache population is best-effort; fall back to on-demand lookups.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># --- Public API ---</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ingest an XML instance from a string, returning the created root Django instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_etree</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">_etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ingest_root_element</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">ingest_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ingest an XML instance from a file path, returning the created root Django instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">xml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">xml_path</span><span class="p">)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_etree</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">with</span> <span class="n">xml_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">tree</span> <span class="o">=</span> <span class="n">_etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ingest_root_element</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ContractIssue</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate that discovered schema types align with installed Django models.</span>

<span class="sd">        - Ensures expected fields from attributes, simple elements, and single nested complex</span>
<span class="sd">          elements exist on the corresponding Django model.</span>
<span class="sd">        - Flags Timescale-based models that are missing the canonical &#39;time&#39; field.</span>

<span class="sd">        Returns a list of ContractIssue. If strict=True and issues exist, raises SchemaSyncError</span>
<span class="sd">        with a concise remediation message.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">issues</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ContractIssue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">complex_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">())</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">complex_types</span><span class="p">:</span>
                <span class="n">model_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_for_complex_type</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">model_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ContractIssue</span><span class="p">(</span>
                            <span class="n">complex_type_name</span><span class="o">=</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">model_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">missing_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&lt;installed model not found&gt;&quot;</span><span class="p">],</span>
                            <span class="n">extra_fields</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">problems</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;No installed Django model resolved for complex type&quot;</span><span class="p">],</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>

                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">model_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

                <span class="n">expected_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="c1"># Attributes</span>
                <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">expected_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">attr_name</span><span class="p">))</span>
                <span class="c1"># Elements (simple + parent links for single nested complex)</span>
                <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;elements&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;type_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;base_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;is_list&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                            <span class="n">expected_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                        <span class="k">continue</span>
                    <span class="n">expected_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

                <span class="n">missing</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">expected_fields</span> <span class="k">if</span> <span class="n">fn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">])</span>
                <span class="n">problems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_timescale_model</span><span class="p">(</span><span class="n">model_cls</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">:</span>
                    <span class="n">problems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Timescale model missing required &#39;time&#39; field&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">missing</span> <span class="ow">or</span> <span class="n">problems</span><span class="p">:</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">ContractIssue</span><span class="p">(</span>
                            <span class="n">complex_type_name</span><span class="o">=</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                            <span class="n">model_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">model_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                            <span class="n">missing_fields</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                            <span class="n">extra_fields</span><span class="o">=</span><span class="p">[],</span>
                            <span class="n">problems</span><span class="o">=</span><span class="n">problems</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="n">issues</span><span class="p">:</span>
            <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">] missing=</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">missing_fields</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="si">}</span><span class="s2"> problems=</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">problems</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">SchemaSyncError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Schema and static model are out of sync; verify schema and/or regenerate static Django models and re-migrate. Details: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">issues</span>

    <span class="c1"># --- Core ingestion ---</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_ingest_root_element</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">elem</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="n">local_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_name</span><span class="p">(</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
        <span class="n">complex_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_resolve_root_complex_type</span><span class="p">(</span><span class="n">local_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">complex_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">known_types</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
                    <span class="n">known_types</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">()])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Could not resolve complex type for root element &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="n">local_name</span><span class="si">}</span><span class="s2">&#39;. Known discovered types (sample): &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">known_types</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="n">model_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_for_complex_type</span><span class="p">(</span><span class="n">complex_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">model_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find Django model for complex type &#39;</span><span class="si">{</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>

        <span class="n">instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_instance_from_element</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="n">complex_type</span><span class="p">,</span> <span class="n">model_cls</span><span class="p">,</span> <span class="n">parent_instance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_instance_from_element</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">elem</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">complex_type</span><span class="p">:</span> <span class="n">XmlSchemaComplexType</span><span class="p">,</span>
        <span class="n">model_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">,</span>
        <span class="n">parent_instance</span><span class="p">:</span> <span class="n">Any</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">parent_link_field</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and save a Django model instance from an XML element according to its complex type.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Prepare field values for simple elements and attributes first</span>
        <span class="n">field_values</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Attributes on complex types</span>
        <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">_attr</span> <span class="ow">in</span> <span class="n">complex_type</span><span class="o">.</span><span class="n">attributes</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">xml_attr_value</span> <span class="o">=</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xml_attr_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dj_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
                <span class="n">field_values</span><span class="p">[</span><span class="n">dj_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">xml_attr_value</span>

        <span class="c1"># Child elements</span>
        <span class="n">children_by_local</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">lname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_local_name</span><span class="p">(</span><span class="n">child</span><span class="o">.</span><span class="n">tag</span><span class="p">)</span>
            <span class="n">children_by_local</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">lname</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>

        <span class="c1"># Strict mode: detect unexpected XML child elements and attributes not declared in the schema</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span><span class="p">:</span>
            <span class="n">expected_child_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">e</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">complex_type</span><span class="p">,</span> <span class="s2">&quot;elements&quot;</span><span class="p">,</span> <span class="p">[])}</span>
            <span class="n">unexpected_children</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">children_by_local</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expected_child_names</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">unexpected_children</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SchemaSyncError</span><span class="p">(</span>
                    <span class="s2">&quot;Schema and static model are out of sync; verify schema and/or regenerate static Django models and re-migrate. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Unexpected XML elements for type &#39;</span><span class="si">{</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">unexpected_children</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
            <span class="n">expected_attr_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">complex_type</span><span class="p">,</span> <span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">xml_attr_local</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_local_name</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">()}</span>
            <span class="n">unexpected_attrs</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xml_attr_local</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">expected_attr_names</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">unexpected_attrs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SchemaSyncError</span><span class="p">(</span>
                    <span class="s2">&quot;Schema and static model are out of sync; verify schema and/or regenerate static Django models and re-migrate. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Unmapped XML attributes for type &#39;</span><span class="si">{</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">unexpected_attrs</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Map simple fields and collect nested complex elements to process</span>
        <span class="n">nested_to_process</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">XmlSchemaElement</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">el_def</span> <span class="ow">in</span> <span class="n">complex_type</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">el_def</span><span class="o">.</span><span class="n">name</span>
            <span class="n">matched_children</span> <span class="o">=</span> <span class="n">children_by_local</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="p">[])</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">matched_children</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">el_def</span><span class="o">.</span><span class="n">type_name</span> <span class="ow">and</span> <span class="n">el_def</span><span class="o">.</span><span class="n">base_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Nested complex type</span>
                <span class="n">nested_to_process</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">el_def</span><span class="p">,</span> <span class="n">matched_children</span><span class="p">))</span>
                <span class="k">continue</span>

            <span class="c1"># Simple content</span>
            <span class="c1"># Multiple occurrences of a simple element -&gt; pick first; advanced list handling can be added later</span>
            <span class="n">first</span> <span class="o">=</span> <span class="n">matched_children</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dj_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
            <span class="n">field_values</span><span class="p">[</span><span class="n">dj_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">text</span>

        <span class="c1"># If this element is a repeated child (child_fk strategy), and we know the FK field name</span>
        <span class="c1"># on the child model, include it in initial field values to satisfy NOT NULL constraints.</span>
        <span class="k">if</span> <span class="n">parent_instance</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">parent_link_field</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
                <span class="k">if</span> <span class="n">parent_link_field</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">:</span>
                    <span class="n">field_values</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">parent_link_field</span><span class="p">,</span> <span class="n">parent_instance</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="c1"># Instantiate without other relationships first</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">Any</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span><span class="p">:</span>
            <span class="c1"># Timescale-aware timestamp remapping: if model expects a &#39;time&#39; field,</span>
            <span class="c1"># remap common XML timestamp attributes (e.g., creationTime â†’ creation_time)</span>
            <span class="c1"># into &#39;time&#39; when not already provided.</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">model_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">has_timescale_time_field</span><span class="p">(</span><span class="n">model_field_names</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_values</span><span class="p">:</span>
                <span class="c1"># Always attempt a helpful alias remap; only enforce requiredness for Timescale models</span>
                <span class="n">map_time_alias_into_time</span><span class="p">(</span><span class="n">field_values</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">TIMESERIES_TIME_ALIASES</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_timescale_model</span><span class="p">(</span><span class="n">model_cls</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_values</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TimeseriesTimestampMissingError</span><span class="p">(</span>
                        <span class="n">model_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">attempted_aliases</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">TIMESERIES_TIME_ALIASES</span><span class="p">)</span>
                    <span class="p">)</span>

            <span class="n">instance</span> <span class="o">=</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">field_values</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Mirror the same remapping for unsaved construction flows</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">model_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">has_timescale_time_field</span><span class="p">(</span><span class="n">model_field_names</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_values</span><span class="p">:</span>
                    <span class="c1"># For unsaved flows, remap aliases but do not enforce a hard requirement</span>
                    <span class="n">map_time_alias_into_time</span><span class="p">(</span><span class="n">field_values</span><span class="p">,</span> <span class="n">aliases</span><span class="o">=</span><span class="n">TIMESERIES_TIME_ALIASES</span><span class="p">)</span>
                <span class="n">instance</span> <span class="o">=</span> <span class="n">model_cls</span><span class="p">(</span><span class="o">**</span><span class="n">field_values</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="c1"># If the dynamically generated class is abstract (not installed app),</span>
                <span class="c1"># construct a lightweight proxy object for unsaved workflows.</span>
                <span class="n">is_abstract</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">model_cls</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;abstract&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_abstract</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">proxy_cls</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="n">model_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{})</span>
                        <span class="n">instance</span> <span class="o">=</span> <span class="n">proxy_cls</span><span class="p">()</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">field_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot instantiate abstract model &#39;</span><span class="si">{</span><span class="n">model_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>

        <span class="c1"># Track created/instantiated instance</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">instance</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Attach any remaining XML attributes as dynamic attributes if not mapped</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
            <span class="n">unmapped_dynamic</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">attr_name</span><span class="p">,</span> <span class="n">attr_val</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">elem</span><span class="p">,</span> <span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">dj_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">attr_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">dj_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">field_values</span> <span class="ow">and</span> <span class="n">dj_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span><span class="p">:</span>
                        <span class="n">unmapped_dynamic</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dj_name</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">dj_name</span><span class="p">,</span> <span class="n">attr_val</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span> <span class="ow">and</span> <span class="n">unmapped_dynamic</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">SchemaSyncError</span><span class="p">(</span>
                    <span class="s2">&quot;Schema and static model are out of sync; verify schema and/or regenerate static Django models and re-migrate. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Unmapped XML attributes for type &#39;</span><span class="si">{</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="n">unmapped_dynamic</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># Handle nested complex elements</span>
        <span class="k">for</span> <span class="n">el_def</span><span class="p">,</span> <span class="n">elements</span> <span class="ow">in</span> <span class="n">nested_to_process</span><span class="p">:</span>
            <span class="n">target_type_name</span> <span class="o">=</span> <span class="p">(</span><span class="n">el_def</span><span class="o">.</span><span class="n">type_name</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">target_complex_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_complex_type</span><span class="p">(</span><span class="n">target_type_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_complex_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Unknown nested complex type &#39;</span><span class="si">%s</span><span class="s2">&#39; for element &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span> <span class="n">target_type_name</span><span class="p">,</span> <span class="n">el_def</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">target_model_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_for_complex_type</span><span class="p">(</span><span class="n">target_complex_type</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">target_model_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Missing Django model for nested type &#39;</span><span class="si">%s</span><span class="s2">&#39; (element &#39;</span><span class="si">%s</span><span class="s2">&#39;)&quot;</span><span class="p">,</span> <span class="n">target_type_name</span><span class="p">,</span> <span class="n">el_def</span><span class="o">.</span><span class="n">name</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="n">el_def</span><span class="o">.</span><span class="n">is_list</span><span class="p">:</span>
                <span class="c1"># If the parent model exposes GenericRelation(&#39;entries&#39;), persist as GenericEntry rows</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">has_entries</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;entries&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">has_entries</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="k">if</span> <span class="n">has_entries</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">GenericEntry</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.GenericEntry&quot;</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">GenericEntry</span> <span class="o">=</span> <span class="kc">None</span>
                    <span class="k">if</span> <span class="n">GenericEntry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">child_elem</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
                            <span class="n">entry_data_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_generic_entry_kwargs</span><span class="p">(</span>
                                <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span>
                                <span class="n">el_name</span><span class="o">=</span><span class="n">el_def</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                <span class="n">target_type_name</span><span class="o">=</span><span class="n">target_type_name</span><span class="p">,</span>
                                <span class="n">child_elem</span><span class="o">=</span><span class="n">child_elem</span><span class="p">,</span>
                                <span class="n">GenericEntry</span><span class="o">=</span><span class="n">GenericEntry</span><span class="p">,</span>
                                <span class="n">order_index</span><span class="o">=</span><span class="n">idx</span><span class="p">,</span>
                            <span class="p">)</span>
                            <span class="c1"># Create entry row</span>
                            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span><span class="p">:</span>
                                <span class="n">GenericEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">entry_data_kwargs</span><span class="p">)</span>
                        <span class="c1"># Skip concrete child instance creation when using GFK</span>
                        <span class="k">continue</span>
                <span class="c1"># Default generation style &#39;child_fk&#39;: inject FK on child named after parent class in lowercase</span>
                <span class="n">parent_fk_field</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">child_elem</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
                    <span class="n">child_instance</span><span class="p">:</span> <span class="n">Any</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_instance_from_element</span><span class="p">(</span>
                        <span class="n">child_elem</span><span class="p">,</span>
                        <span class="n">target_complex_type</span><span class="p">,</span>
                        <span class="n">target_model_cls</span><span class="p">,</span>
                        <span class="n">parent_instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span>
                        <span class="n">parent_link_field</span><span class="o">=</span><span class="n">parent_fk_field</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># Set parent FK on child; save update if field exists</span>
                    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">child_instance</span><span class="p">,</span> <span class="n">parent_fk_field</span><span class="p">):</span>
                        <span class="nb">setattr</span><span class="p">(</span><span class="n">child_instance</span><span class="p">,</span> <span class="n">parent_fk_field</span><span class="p">,</span> <span class="n">instance</span><span class="p">)</span>
                        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span><span class="p">:</span>
                            <span class="n">child_instance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="n">parent_fk_field</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># If strategy was m2m/json, this will be a no-op; can extend later</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                            <span class="s2">&quot;Child model </span><span class="si">%s</span><span class="s2"> lacks FK field &#39;</span><span class="si">%s</span><span class="s2">&#39; to parent; skipping back-link&quot;</span><span class="p">,</span>
                            <span class="n">child_instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                            <span class="n">parent_fk_field</span><span class="p">,</span>
                        <span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Single nested complex element: either FK on parent or GFK entry (all_nested policy)</span>
            <span class="n">parent_fk_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">el_def</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="c1"># If parent exposes entries and does NOT define a concrete FK field for this element, persist as GenericEntry</span>
            <span class="n">use_gfk_single</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">has_entries</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;entries&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">has_entries</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">has_entries</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">model_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">parent_fk_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">:</span>
                    <span class="n">use_gfk_single</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">use_gfk_single</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">GenericEntry</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.GenericEntry&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">GenericEntry</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="k">if</span> <span class="n">GenericEntry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">child_elem</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">single_entry_kwargs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_generic_entry_kwargs</span><span class="p">(</span>
                        <span class="n">instance</span><span class="o">=</span><span class="n">instance</span><span class="p">,</span>
                        <span class="n">el_name</span><span class="o">=</span><span class="n">el_def</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">target_type_name</span><span class="o">=</span><span class="n">target_type_name</span><span class="p">,</span>
                        <span class="n">child_elem</span><span class="o">=</span><span class="n">child_elem</span><span class="p">,</span>
                        <span class="n">GenericEntry</span><span class="o">=</span><span class="n">GenericEntry</span><span class="p">,</span>
                        <span class="n">order_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span><span class="p">:</span>
                        <span class="n">GenericEntry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="o">**</span><span class="n">single_entry_kwargs</span><span class="p">)</span>
                <span class="c1"># Skip concrete child instance creation</span>
                <span class="k">continue</span>

            <span class="c1"># Default: create child instance and set FK on parent</span>
            <span class="n">child_elem</span> <span class="o">=</span> <span class="n">elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">child_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_build_instance_from_element</span><span class="p">(</span>
                <span class="n">child_elem</span><span class="p">,</span> <span class="n">target_complex_type</span><span class="p">,</span> <span class="n">target_model_cls</span><span class="p">,</span> <span class="n">parent_instance</span><span class="o">=</span><span class="n">instance</span>
            <span class="p">)</span>

            <span class="c1"># For proxy instances (non-Django), the attribute may not exist yet; set unconditionally</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">parent_fk_name</span><span class="p">,</span> <span class="n">child_instance</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="s2">&quot;save&quot;</span><span class="p">):</span>
                    <span class="n">instance</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="n">parent_fk_name</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="s2">&quot;Could not set nested field &#39;</span><span class="si">%s</span><span class="s2">&#39; on parent </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">parent_fk_name</span><span class="p">,</span>
                    <span class="n">instance</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">instance</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_build_generic_entry_kwargs</span><span class="p">(</span>
        <span class="o">*</span><span class="p">,</span>
        <span class="n">instance</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">el_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">target_type_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">child_elem</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">GenericEntry</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span>
        <span class="n">order_index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build keyword args for creating a `GenericEntry` row from an XML child element.</span>

<span class="sd">        Behavior is aligned with GFK flag semantics:</span>
<span class="sd">        - `gfk_value_mode=&quot;json_only&quot;`: element text is stored inside `attrs_json[&quot;value&quot;]`.</span>
<span class="sd">        - `gfk_value_mode=&quot;typed_columns&quot;`: if the `GenericEntry` model declares typed</span>
<span class="sd">          columns (`text_value`, `num_value`, `time_value`), element text is copied to</span>
<span class="sd">          `text_value` and parsed into `num_value` and/or `time_value` when unambiguous.</span>
<span class="sd">          Remaining attributes are preserved in `attrs_json`.</span>

<span class="sd">        Args:</span>
<span class="sd">            instance: The owning Django model instance for `content_object`.</span>
<span class="sd">            el_name: Local name of the XML element.</span>
<span class="sd">            target_type_name: Resolved type name for the element (simple or complex), if available.</span>
<span class="sd">            child_elem: Parsed XML element (lxml Element or equivalent).</span>
<span class="sd">            GenericEntry: The `GenericEntry` Django model class for this app.</span>
<span class="sd">            order_index: Monotonic index of this entry under the owner, used to preserve order.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dict of keyword arguments suitable for `GenericEntry.objects.create(**kwargs)`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">entry_attrs_json</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_elem</span><span class="p">,</span> <span class="s2">&quot;attrib&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">entry_attrs_json</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">entry_kwargs</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;content_object&quot;</span><span class="p">:</span> <span class="n">instance</span><span class="p">,</span>
            <span class="s2">&quot;element_qname&quot;</span><span class="p">:</span> <span class="n">el_name</span><span class="p">,</span>
            <span class="s2">&quot;type_qname&quot;</span><span class="p">:</span> <span class="n">target_type_name</span> <span class="ow">or</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;attrs_json&quot;</span><span class="p">:</span> <span class="n">entry_attrs_json</span><span class="p">,</span>
            <span class="s2">&quot;order_index&quot;</span><span class="p">:</span> <span class="n">order_index</span><span class="p">,</span>
            <span class="s2">&quot;path_hint&quot;</span><span class="p">:</span> <span class="n">el_name</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="c1"># Handle text value</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">text_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_elem</span><span class="p">,</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">text_val</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">text_val</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">text_val</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">raw</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text_val</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="c1"># If GenericEntry defines typed columns, attempt parse to numeric/time</span>
            <span class="n">has_text_col</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">has_text_col</span> <span class="o">=</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">GenericEntry</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;text_value&quot;</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">GenericEntry</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">has_text_col</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">has_text_col</span><span class="p">:</span>
                <span class="n">entry_kwargs</span><span class="p">[</span><span class="s2">&quot;text_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">entry_kwargs</span><span class="p">[</span><span class="s2">&quot;num_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">raw</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">iso</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span> <span class="s2">&quot;+00:00&quot;</span><span class="p">)</span>
                    <span class="n">entry_kwargs</span><span class="p">[</span><span class="s2">&quot;time_value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">_dt</span><span class="o">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">iso</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">entry_attrs_json</span><span class="p">[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">raw</span>

        <span class="k">return</span> <span class="n">entry_kwargs</span>

    <span class="c1"># --- Helpers ---</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_resolve_root_complex_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">root_local_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XmlSchemaComplexType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Try global elements with explicit type</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
            <span class="n">element</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">root_local_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">element</span> <span class="ow">and</span> <span class="n">element</span><span class="o">.</span><span class="n">type_name</span><span class="p">:</span>
                <span class="n">type_name</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ct</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">find_complex_type</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ct</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">ct</span>
        <span class="c1"># Try complex type named exactly as root</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">find_complex_type</span><span class="p">(</span><span class="n">root_local_name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ct</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ct</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_find_complex_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">XmlSchemaComplexType</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
            <span class="n">ct</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">find_complex_type</span><span class="p">(</span><span class="n">type_name</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="n">schema</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ct</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">ct</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_model_for_complex_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">complex_type</span><span class="p">:</span> <span class="n">XmlSchemaComplexType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">model_name</span> <span class="o">=</span> <span class="n">complex_type</span><span class="o">.</span><span class="n">name</span>
        <span class="c1"># Prefer cache of installed models first for determinism across root and nested types</span>
        <span class="n">cached</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_model_resolution_cache&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cached</span>

        <span class="c1"># Otherwise, attempt to resolve from app registry, then fall back to generated stand-ins</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">model_cls</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="c1"># Populate cache for subsequent lookups</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cls</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">return</span> <span class="n">model_cls</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># Optionally fallback to in-memory registry for dynamically generated classes</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_dynamic_model_fallback&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">):</span>
                <span class="c1"># Provide a detailed error to aid configuration</span>
                <span class="k">raise</span> <span class="n">ModelResolutionError</span><span class="p">(</span>
                    <span class="n">app_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
                    <span class="n">model_name</span><span class="o">=</span><span class="n">model_name</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="p">(</span>
                        <span class="s2">&quot;Installed Django model not found and dynamic model fallback is disabled. &quot;</span>
                        <span class="s2">&quot;Ensure your concrete models are installed under the correct app label, or enable &quot;</span>
                        <span class="s2">&quot;dynamic fallback explicitly.&quot;</span>
                    <span class="p">),</span>
                <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">get_generated_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_is_timescale_model</span><span class="p">(</span><span class="n">model_cls</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pydantic2django.django.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">TimescaleModel</span> <span class="k">as</span> <span class="n">_TsModel</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span><span class="n">model_cls</span><span class="p">,</span> <span class="n">_TsModel</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_local_name</span><span class="p">(</span><span class="n">qname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;}&quot;</span> <span class="ow">in</span> <span class="n">qname</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="s2">&quot;:&quot;</span> <span class="ow">in</span> <span class="n">qname</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">qname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">qname</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">_xml_name_to_django_field</span><span class="p">(</span><span class="n">xml_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="c1"># Use shared normalization so all ingestion paths stay consistent</span>
        <span class="k">return</span> <span class="n">sanitize_field_identifier</span><span class="p">(</span><span class="n">xml_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlInstanceIngestor.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">schema_files</span><span class="p">,</span> <span class="n">app_label</span><span class="p">,</span> <span class="n">dynamic_model_fallback</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.XmlInstanceIngestor.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize a schema-aware XML ingestor.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema_files</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Paths to XSD files used to parse/resolve types.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>app_label</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Django app label expected to contain installed models.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dynamic_model_fallback</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Controls behavior when an installed model is missing.
- True: fall back to dynamically generated stand-ins from the
  in-memory registry, allowing unsaved/ephemeral workflows.
- False (default): raise ModelResolutionError when a discovered complex type cannot be
  resolved to an installed Django model, avoiding implicit usage of stand-ins.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="behavior" open>
  <summary>Behavior</summary>
  <ul>
<li>Regardless of the fallback flag, the ingestor will always prefer installed Django
  models and pre-cache them for all discovered complex types to ensure consistent
  resolution across root and nested elements.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/ingestor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="o">*</span><span class="p">,</span>
    <span class="n">schema_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span>
    <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">dynamic_model_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialize a schema-aware XML ingestor.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema_files: Paths to XSD files used to parse/resolve types.</span>
<span class="sd">        app_label: Django app label expected to contain installed models.</span>
<span class="sd">        dynamic_model_fallback: Controls behavior when an installed model is missing.</span>
<span class="sd">            - True: fall back to dynamically generated stand-ins from the</span>
<span class="sd">              in-memory registry, allowing unsaved/ephemeral workflows.</span>
<span class="sd">            - False (default): raise ModelResolutionError when a discovered complex type cannot be</span>
<span class="sd">              resolved to an installed Django model, avoiding implicit usage of stand-ins.</span>

<span class="sd">    Behavior:</span>
<span class="sd">        - Regardless of the fallback flag, the ingestor will always prefer installed Django</span>
<span class="sd">          models and pre-cache them for all discovered complex types to ensure consistent</span>
<span class="sd">          resolution across root and nested elements.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>  <span class="c1"># Validate dependency early</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span>  <span class="c1"># noqa: F401</span>
    <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - environment dependent</span>
        <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span><span class="s2">&quot;lxml is required for XML ingestion. Install with: pip install lxml&quot;</span><span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span> <span class="o">=</span> <span class="n">app_label</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_model_fallback</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">dynamic_model_fallback</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">strict</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">discovery</span> <span class="o">=</span> <span class="n">XmlSchemaDiscovery</span><span class="p">()</span>
    <span class="n">discovery</span><span class="o">.</span><span class="n">discover_models</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">schema_files</span><span class="p">],</span> <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">)</span>
    <span class="c1"># Keep references for mapping</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">XmlSchemaDefinition</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">discovery</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">)</span>

    <span class="c1"># Pre-resolve and cache installed Django model classes for all discovered complex types.</span>
    <span class="c1"># This guarantees we consistently use concrete models (with managers) when available.</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">discovered_names</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">schema</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">():</span>
                <span class="n">discovered_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">model_name</span> <span class="ow">in</span> <span class="n">discovered_names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_cls</span> <span class="o">=</span> <span class="n">django_apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">model_cls</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">model_cls</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span><span class="p">[</span><span class="n">model_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_cls</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="c1"># Cache population is best-effort; fall back to on-demand lookups.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_model_resolution_cache</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlInstanceIngestor.ingest_from_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ingest_from_file</span><span class="p">(</span><span class="n">xml_path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.XmlInstanceIngestor.ingest_from_file" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Ingest an XML instance from a file path, returning the created root Django instance.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/ingestor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ingest_from_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ingest an XML instance from a file path, returning the created root Django instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xml_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">xml_path</span><span class="p">)</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_etree</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">with</span> <span class="n">xml_path</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">tree</span> <span class="o">=</span> <span class="n">_etree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ingest_root_element</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlInstanceIngestor.ingest_from_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ingest_from_string</span><span class="p">(</span><span class="n">xml_string</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.XmlInstanceIngestor.ingest_from_string" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Ingest an XML instance from a string, returning the created root Django instance.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/ingestor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">ingest_from_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xml_string</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">save</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ingest an XML instance from a string, returning the created root Django instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">lxml.etree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_etree</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_save_objects</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">save</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">created_instances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">_etree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ingest_root_element</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlInstanceIngestor.validate_models" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_models</span><span class="p">(</span><span class="o">*</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.XmlInstanceIngestor.validate_models" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Validate that discovered schema types align with installed Django models.</p>
<ul>
<li>Ensures expected fields from attributes, simple elements, and single nested complex
  elements exist on the corresponding Django model.</li>
<li>Flags Timescale-based models that are missing the canonical 'time' field.</li>
</ul>
<p>Returns a list of ContractIssue. If strict=True and issues exist, raises SchemaSyncError
with a concise remediation message.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/ingestor.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_models</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">ContractIssue</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate that discovered schema types align with installed Django models.</span>

<span class="sd">    - Ensures expected fields from attributes, simple elements, and single nested complex</span>
<span class="sd">      elements exist on the corresponding Django model.</span>
<span class="sd">    - Flags Timescale-based models that are missing the canonical &#39;time&#39; field.</span>

<span class="sd">    Returns a list of ContractIssue. If strict=True and issues exist, raises SchemaSyncError</span>
<span class="sd">    with a concise remediation message.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">issues</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ContractIssue</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">schema</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_schemas</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">complex_types</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">schema</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">complex_types</span><span class="p">:</span>
            <span class="n">model_cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_model_for_complex_type</span><span class="p">(</span><span class="n">ct</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">model_cls</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ContractIssue</span><span class="p">(</span>
                        <span class="n">complex_type_name</span><span class="o">=</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">model_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">missing_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&lt;installed model not found&gt;&quot;</span><span class="p">],</span>
                        <span class="n">extra_fields</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">problems</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;No installed Django model resolved for complex type&quot;</span><span class="p">],</span>
                    <span class="p">)</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_field_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">f</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">model_cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">fields</span><span class="p">}</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">model_field_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

            <span class="n">expected_fields</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="c1"># Attributes</span>
            <span class="k">for</span> <span class="n">attr_name</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;attributes&quot;</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">expected_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">attr_name</span><span class="p">))</span>
            <span class="c1"># Elements (simple + parent links for single nested complex)</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;elements&quot;</span><span class="p">,</span> <span class="p">[]):</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;type_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;base_type&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">el</span><span class="p">,</span> <span class="s2">&quot;is_list&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="n">expected_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">continue</span>
                <span class="n">expected_fields</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_xml_name_to_django_field</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

            <span class="n">missing</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">fn</span> <span class="k">for</span> <span class="n">fn</span> <span class="ow">in</span> <span class="n">expected_fields</span> <span class="k">if</span> <span class="n">fn</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">])</span>
            <span class="n">problems</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_timescale_model</span><span class="p">(</span><span class="n">model_cls</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;time&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_field_names</span><span class="p">:</span>
                <span class="n">problems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Timescale model missing required &#39;time&#39; field&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">missing</span> <span class="ow">or</span> <span class="n">problems</span><span class="p">:</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="n">ContractIssue</span><span class="p">(</span>
                        <span class="n">complex_type_name</span><span class="o">=</span><span class="n">ct</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                        <span class="n">model_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="n">model_cls</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">missing_fields</span><span class="o">=</span><span class="n">missing</span><span class="p">,</span>
                        <span class="n">extra_fields</span><span class="o">=</span><span class="p">[],</span>
                        <span class="n">problems</span><span class="o">=</span><span class="n">problems</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="n">issues</span><span class="p">:</span>
        <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">model_name</span><span class="si">}</span><span class="s2">] missing=</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">missing_fields</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="si">}</span><span class="s2"> problems=</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">problems</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;-&#39;</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">issues</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">SchemaSyncError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Schema and static model are out of sync; verify schema and/or regenerate static Django models and re-migrate. Details: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="k">return</span> <span class="n">issues</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator" class="doc doc-heading">
            <code>XmlSchemaDjangoModelGenerator</code>


<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="BaseStaticGenerator (pydantic2django.core.base_generator.BaseStaticGenerator)" href="../../../Architecture/OVERVIEW/#pydantic2django.core.base_generator.BaseStaticGenerator">BaseStaticGenerator</a>[<a class="autorefs autorefs-internal" title="XmlSchemaComplexType


  
      dataclass
   (pydantic2django.xmlschema.models.XmlSchemaComplexType)" href="models/#pydantic2django.xmlschema.models.XmlSchemaComplexType">XmlSchemaComplexType</a>, <a class="autorefs autorefs-internal" title="XmlSchemaFieldInfo


  
      dataclass
   (pydantic2django.xmlschema.factory.XmlSchemaFieldInfo)" href="factory/#pydantic2django.xmlschema.factory.XmlSchemaFieldInfo">XmlSchemaFieldInfo</a>]</code></p>


        <p>Main class to orchestrate the generation of Django models from XML Schemas.</p>







              <details class="quote">
                <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">XmlSchemaDjangoModelGenerator</span><span class="p">(</span><span class="n">BaseStaticGenerator</span><span class="p">[</span><span class="n">XmlSchemaComplexType</span><span class="p">,</span> <span class="n">XmlSchemaFieldInfo</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main class to orchestrate the generation of Django models from XML Schemas.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">schema_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span>
        <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;generated_models.py&quot;</span><span class="p">,</span>
        <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;xmlschema_app&quot;</span><span class="p">,</span>
        <span class="n">filter_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">XmlSchemaComplexType</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">module_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">class_name_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="c1"># Relationship handling for nested complex types</span>
        <span class="n">nested_relationship_strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fk&quot;</span><span class="p">,</span>  <span class="c1"># one of: &quot;fk&quot;, &quot;json&quot;, &quot;auto&quot;</span>
        <span class="n">list_relationship_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;child_fk&quot;</span><span class="p">,</span>  <span class="c1"># one of: &quot;child_fk&quot;, &quot;m2m&quot;, &quot;json&quot;</span>
        <span class="n">nesting_depth_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="c1"># Optional override for the Django base model class</span>
        <span class="n">base_model_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="c1"># Feature flags</span>
        <span class="n">enable_timescale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="c1"># Timescale configuration</span>
        <span class="n">timescale_overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TimescaleRole</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timescale_config</span><span class="p">:</span> <span class="n">TimescaleConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">timescale_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># Control behavior for missing leaf/child targets in finalize pass</span>
        <span class="n">auto_generate_missing_leaves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="c1"># --- GFK flags ---</span>
        <span class="n">enable_gfk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">gfk_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;threshold_by_children&quot;</span><span class="p">,</span>
        <span class="n">gfk_threshold_children</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
        <span class="n">gfk_value_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;typed_columns&quot;</span><span class="p">,</span>
        <span class="n">gfk_normalize_common_attrs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">gfk_overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create a XML Schema â†’ Django generator with optional Generic Entries mode.</span>

<span class="sd">        GFK (Generic Entries) flags:</span>
<span class="sd">        - enable_gfk: Enable Generic Entries mode. When True and policy matches, parents</span>
<span class="sd">          gain `entries = GenericRelation(&#39;GenericEntry&#39;)` and concrete children are not emitted.</span>
<span class="sd">        - gfk_policy: Controls which nested elements are routed to GenericEntry.</span>
<span class="sd">          Values: &quot;substitution_only&quot; | &quot;repeating_only&quot; | &quot;all_nested&quot; | &quot;threshold_by_children&quot;.</span>
<span class="sd">        - gfk_threshold_children: Used only with &quot;threshold_by_children&quot;; minimum distinct child</span>
<span class="sd">          complex types inside a wrapper-like container to activate GFK.</span>
<span class="sd">        - gfk_value_mode: &quot;json_only&quot; stores text under attrs_json[&#39;value&#39;]; &quot;typed_columns&quot;</span>
<span class="sd">          extracts text into text_value, num_value, time_value when unambiguous.</span>
<span class="sd">        - gfk_normalize_common_attrs: Reserved (default False) for promoting frequently used</span>
<span class="sd">          attributes (e.g., timestamp) into normalized columns when using typed columns.</span>
<span class="sd">        - gfk_overrides: Optional per-element overrides by local element name;</span>
<span class="sd">          True forces GFK, False disables it even if the policy would apply.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">discovery</span> <span class="o">=</span> <span class="n">XmlSchemaDiscovery</span><span class="p">()</span>
        <span class="n">model_factory</span> <span class="o">=</span> <span class="n">XmlSchemaModelFactory</span><span class="p">(</span>
            <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">,</span>
            <span class="n">nested_relationship_strategy</span><span class="o">=</span><span class="n">nested_relationship_strategy</span><span class="p">,</span>
            <span class="n">list_relationship_style</span><span class="o">=</span><span class="n">list_relationship_style</span><span class="p">,</span>
            <span class="n">nesting_depth_threshold</span><span class="o">=</span><span class="n">nesting_depth_threshold</span><span class="p">,</span>
            <span class="n">enable_gfk</span><span class="o">=</span><span class="n">enable_gfk</span><span class="p">,</span>
            <span class="n">gfk_policy</span><span class="o">=</span><span class="n">gfk_policy</span><span class="p">,</span>
            <span class="n">gfk_threshold_children</span><span class="o">=</span><span class="n">gfk_threshold_children</span><span class="p">,</span>
            <span class="n">gfk_overrides</span><span class="o">=</span><span class="n">gfk_overrides</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
            <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">schema_files</span><span class="p">],</span>
            <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">,</span>
            <span class="n">discovery_instance</span><span class="o">=</span><span class="n">discovery</span><span class="p">,</span>
            <span class="n">model_factory_instance</span><span class="o">=</span><span class="n">model_factory</span><span class="p">,</span>
            <span class="n">base_model_class</span><span class="o">=</span><span class="n">base_model_class</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_base_model_class</span><span class="p">(),</span>
            <span class="n">class_name_prefix</span><span class="o">=</span><span class="n">class_name_prefix</span><span class="p">,</span>
            <span class="n">module_mappings</span><span class="o">=</span><span class="n">module_mappings</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="n">filter_function</span><span class="o">=</span><span class="n">filter_function</span><span class="p">,</span>
            <span class="n">enable_timescale</span><span class="o">=</span><span class="n">enable_timescale</span><span class="p">,</span>
            <span class="n">enable_gfk</span><span class="o">=</span><span class="n">enable_gfk</span><span class="p">,</span>
            <span class="n">gfk_policy</span><span class="o">=</span><span class="n">gfk_policy</span><span class="p">,</span>
            <span class="n">gfk_threshold_children</span><span class="o">=</span><span class="n">gfk_threshold_children</span><span class="p">,</span>
            <span class="n">gfk_value_mode</span><span class="o">=</span><span class="n">gfk_value_mode</span><span class="p">,</span>
            <span class="n">gfk_normalize_common_attrs</span><span class="o">=</span><span class="n">gfk_normalize_common_attrs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Timescale classification results cached per run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TimescaleRole</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TimescaleRole</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">timescale_overrides</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_config</span><span class="p">:</span> <span class="n">TimescaleConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">timescale_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">timescale_strict</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_auto_generate_missing_leaves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">auto_generate_missing_leaves</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_model_definition_extra_context</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">carrier</span><span class="p">:</span> <span class="n">ConversionCarrier</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Extracts additional context required for rendering the Django model,</span>
<span class="sd">        including field definitions and enum classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">field_definitions</span> <span class="o">=</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_field_definitions</span>

        <span class="n">enum_classes</span> <span class="o">=</span> <span class="n">carrier</span><span class="o">.</span><span class="n">context_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;enums&quot;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;field_definitions&quot;</span><span class="p">:</span> <span class="n">field_definitions</span><span class="p">,</span>
            <span class="s2">&quot;enum_classes&quot;</span><span class="p">:</span> <span class="n">enum_classes</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
            <span class="c1"># Extra Meta emission (e.g., indexes)</span>
            <span class="s2">&quot;meta_indexes&quot;</span><span class="p">:</span> <span class="n">carrier</span><span class="o">.</span><span class="n">context_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;meta_indexes&quot;</span><span class="p">,</span> <span class="p">[]),</span>
        <span class="p">}</span>

    <span class="c1"># All rendering logic is now handled by the BaseStaticGenerator using the implemented abstract methods.</span>
    <span class="c1"># The custom generate and _generate_file_content methods are no longer needed.</span>

    <span class="c1"># --- Implement abstract methods from BaseStaticGenerator ---</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_source_model_name</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">carrier</span><span class="p">:</span> <span class="n">ConversionCarrier</span><span class="p">[</span><span class="n">XmlSchemaComplexType</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get the name of the original source model from the carrier.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">carrier</span><span class="o">.</span><span class="n">source_model</span><span class="o">.</span><span class="n">name</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_add_source_model_import</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">carrier</span><span class="p">:</span> <span class="n">ConversionCarrier</span><span class="p">[</span><span class="n">XmlSchemaComplexType</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add the necessary import for the original source model.&quot;&quot;&quot;</span>
        <span class="c1"># For XML Schema, the models are generated, not imported</span>
        <span class="k">pass</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_prepare_template_context</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">unique_model_definitions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">django_model_names</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">imports</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Prepare the subclass-specific context for the main models_file.py.j2 template.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;model_definitions&quot;</span><span class="p">:</span> <span class="n">unique_model_definitions</span><span class="p">,</span>
            <span class="s2">&quot;django_model_names&quot;</span><span class="p">:</span> <span class="n">django_model_names</span><span class="p">,</span>
            <span class="c1"># Flattened import categories for templates</span>
            <span class="s2">&quot;pydantic_imports&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">imports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;pydantic&quot;</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="s2">&quot;context_imports&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">imports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;context&quot;</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="s2">&quot;django_imports&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">imports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;django&quot;</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="s2">&quot;general_imports&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">imports</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;general&quot;</span><span class="p">,</span> <span class="p">[])),</span>
            <span class="c1"># Also pass the structured imports dict if templates need it</span>
            <span class="s2">&quot;imports&quot;</span><span class="p">:</span> <span class="n">imports</span><span class="p">,</span>
            <span class="s2">&quot;generation_timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
            <span class="s2">&quot;app_label&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
            <span class="s2">&quot;generation_source_type&quot;</span><span class="p">:</span> <span class="s2">&quot;xmlschema&quot;</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_default_base_model_class</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">type</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the default Django base model for XML Schema conversion.&quot;&quot;&quot;</span>
        <span class="c1"># Prefer local pydantic2django base; fall back to typed2django if present</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">pydantic2django.django.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Xml2DjangoBaseClass</span> <span class="k">as</span> <span class="n">_Base</span>

            <span class="k">return</span> <span class="n">_Base</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Default base model import failed; will try typed2django fallback: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">typed2django.django.models</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                <span class="n">Xml2DjangoBaseClass</span> <span class="k">as</span> <span class="n">_Base</span><span class="p">,</span>  <span class="c1"># type: ignore[import-not-found]</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">_Base</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>  <span class="c1"># pragma: no cover - defensive</span>
            <span class="k">raise</span> <span class="ne">ImportError</span><span class="p">(</span>
                <span class="s2">&quot;pydantic2django.django.models.Xml2DjangoBaseClass (or typed2django equivalent) is required for XML Schema generation.&quot;</span>
            <span class="p">)</span> <span class="kn">from</span><span class="w"> </span><span class="nn">exc</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_models_in_processing_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">XmlSchemaComplexType</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return source models in the correct processing (dependency) order.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">get_models_in_registration_order</span><span class="p">()</span>

    <span class="c1"># --- Additional XML Schema specific methods ---</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_models_with_xml_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate Django models with additional XML metadata.</span>

<span class="sd">        This method extends the base generate() to add XML-specific</span>
<span class="sd">        comments and metadata to the generated models.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_models_file</span><span class="p">()</span>

        <span class="c1"># Add XML Schema file references as comments at the top</span>
        <span class="n">schema_files_comment</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;# Generated from XML Schema: </span><span class="si">{</span><span class="n">schema_file</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">schema_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_files</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Insert after the initial comments</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">insert_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>  <span class="c1"># Single line docstring</span>
                <span class="n">insert_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">break</span>
            <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>  <span class="c1"># Multi-line docstring start</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                        <span class="n">insert_index</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                        <span class="k">break</span>
                <span class="k">break</span>

        <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_index</span><span class="p">,</span> <span class="n">schema_files_comment</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_schema_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get statistics about the parsed schemas.&quot;&quot;&quot;</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;total_schemas&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">),</span>
            <span class="s2">&quot;total_complex_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">all_models</span><span class="p">),</span>
            <span class="s2">&quot;filtered_complex_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span><span class="p">),</span>
            <span class="s2">&quot;generated_models&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">),</span>
        <span class="p">}</span>

        <span class="c1"># Add per-schema breakdown</span>
        <span class="n">schema_breakdown</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">schema_def</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">:</span>
            <span class="n">schema_breakdown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="p">{</span>
                    <span class="s2">&quot;schema_location&quot;</span><span class="p">:</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">schema_location</span><span class="p">,</span>
                    <span class="s2">&quot;target_namespace&quot;</span><span class="p">:</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">,</span>
                    <span class="s2">&quot;complex_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">schema_def</span><span class="o">.</span><span class="n">complex_types</span><span class="p">),</span>
                    <span class="s2">&quot;simple_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">schema_def</span><span class="o">.</span><span class="n">simple_types</span><span class="p">),</span>
                    <span class="s2">&quot;elements&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">schema_def</span><span class="o">.</span><span class="n">elements</span><span class="p">),</span>
                <span class="p">}</span>
            <span class="p">)</span>

        <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;schema_breakdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema_breakdown</span>
        <span class="k">return</span> <span class="n">stats</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_schemas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Validate the parsed schemas and return any warnings or errors.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List of validation messages</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">schema_def</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">:</span>
            <span class="c1"># Check for common issues</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema </span><span class="si">{</span><span class="n">schema_def</span><span class="o">.</span><span class="n">schema_location</span><span class="si">}</span><span class="s2"> has no target namespace&quot;</span><span class="p">)</span>

            <span class="c1"># Check for name conflicts</span>
            <span class="n">all_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">complex_type</span> <span class="ow">in</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">complex_types</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">complex_type</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
                    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate type name: </span><span class="si">{</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">all_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">messages</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">from_schema_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">schema_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;XmlSchemaDjangoModelGenerator&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convenience class method to create generator from schema files.</span>

<span class="sd">        Args:</span>
<span class="sd">            schema_files: List of XSD file paths</span>
<span class="sd">            **kwargs: Additional arguments passed to __init__</span>

<span class="sd">        Returns:</span>
<span class="sd">            Configured XmlSchemaDjangoModelGenerator instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">schema_files</span><span class="o">=</span><span class="n">schema_files</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_render_choices_class</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">choices_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Render a single TextChoices class.&quot;&quot;&quot;</span>
        <span class="n">class_name</span> <span class="o">=</span> <span class="n">choices_info</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
        <span class="n">choices</span> <span class="o">=</span> <span class="n">choices_info</span><span class="p">[</span><span class="s2">&quot;choices&quot;</span><span class="p">]</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;class </span><span class="si">{</span><span class="n">class_name</span><span class="si">}</span><span class="s2">(models.TextChoices):&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">choices</span><span class="p">:</span>
            <span class="c1"># Attempt to create a valid Python identifier for the member name</span>
            <span class="n">member_name</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[^a-zA-Z0-9_]&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">member_name</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">member_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isalpha</span><span class="p">():</span>
                <span class="n">member_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;CHOICE_</span><span class="si">{</span><span class="n">member_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    </span><span class="si">{</span><span class="n">member_name</span><span class="si">}</span><span class="s1"> = &quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;, &quot;</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">n&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Main method to generate the Django models file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting Django model generation to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># The base class now handles the full generation pipeline</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated Django models in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_models_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Override to allow relationship finalization after carriers are built</span>
<span class="sd">        but before rendering templates.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Discover and create carriers first via base implementation pieces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">discover_models</span><span class="p">()</span>
        <span class="c1"># --- GFK Prepass: when enabled, identify wrapper owners and exclude their polymorphic children ---</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_gfk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_policy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">excluded_child_types</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">gfk_owner_wrappers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                <span class="n">policy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_policy&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">threshold_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_threshold_children&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
                <span class="c1"># Walk parsed schemas to infer wrapper owners and their child types</span>
                <span class="k">for</span> <span class="n">schema_def</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="p">,</span> <span class="s2">&quot;parsed_schemas&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">():</span>
                            <span class="c1"># Iterate elements of each complex type</span>
                            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ct</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                                <span class="c1"># Only interested in complex targets</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">type_name</span> <span class="ow">or</span> <span class="n">el</span><span class="o">.</span><span class="n">base_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="k">continue</span>
                                <span class="n">target_type</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">target_ct</span> <span class="o">=</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">complex_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_type</span><span class="p">)</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ct</span><span class="p">:</span>
                                    <span class="k">continue</span>
                                <span class="c1"># Wrapper-like heuristic (may be used by providers; structural checks take precedence)</span>
                                <span class="n">_is_wrapper_like</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_type</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
                                    <span class="s2">&quot;WrapperType&quot;</span>
                                <span class="p">)</span>
                                <span class="c1"># Collect distinct child complex types under target wrapper</span>
                                <span class="n">distinct_child_types</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                                <span class="n">has_substitution_members</span> <span class="o">=</span> <span class="kc">False</span>
                                <span class="n">repeating_leaf_child</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                                <span class="k">for</span> <span class="n">child_el</span> <span class="ow">in</span> <span class="n">target_ct</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;substitution_group&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                        <span class="n">has_substitution_members</span> <span class="o">=</span> <span class="kc">True</span>
                                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;type_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                        <span class="n">cand</span> <span class="o">=</span> <span class="n">child_el</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                        <span class="k">if</span> <span class="n">cand</span><span class="p">:</span>
                                            <span class="n">distinct_child_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cand</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;is_list&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;type_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                        <span class="n">repeating_leaf_child</span> <span class="o">=</span> <span class="n">child_el</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                                <span class="c1"># Decide based on policy (favor generic structural checks over name heuristics)</span>
                                <span class="n">route_by_subst</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;substitution_only&quot;</span> <span class="ow">and</span> <span class="n">has_substitution_members</span>
                                <span class="n">route_by_all_nested</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;all_nested&quot;</span>
                                <span class="n">route_by_threshold</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;threshold_by_children&quot;</span> <span class="ow">and</span> <span class="p">(</span>
                                    <span class="n">threshold_val</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">distinct_child_types</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold_val</span>
                                <span class="p">)</span>
                                <span class="n">route_by_repeating</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;repeating_only&quot;</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">is_list</span><span class="p">)</span>

                                <span class="k">if</span> <span class="n">route_by_subst</span> <span class="ow">or</span> <span class="n">route_by_all_nested</span> <span class="ow">or</span> <span class="n">route_by_threshold</span> <span class="ow">or</span> <span class="n">route_by_repeating</span><span class="p">:</span>
                                    <span class="c1"># Mark the CURRENT complex type (container) as the owner so placeholders on it are suppressed</span>
                                    <span class="k">try</span><span class="p">:</span>
                                        <span class="n">owner_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span>
                                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                        <span class="n">owner_name</span> <span class="o">=</span> <span class="n">target_type</span>
                                    <span class="n">gfk_owner_wrappers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">owner_name</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                                        <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
                                            <span class="s2">&quot;substitution_only&quot;</span>
                                            <span class="k">if</span> <span class="n">route_by_subst</span>
                                            <span class="k">else</span> <span class="p">(</span>
                                                <span class="s2">&quot;all_nested&quot;</span>
                                                <span class="k">if</span> <span class="n">route_by_all_nested</span>
                                                <span class="k">else</span> <span class="p">(</span>
                                                    <span class="s2">&quot;threshold_by_children&quot;</span> <span class="k">if</span> <span class="n">route_by_threshold</span> <span class="k">else</span> <span class="s2">&quot;repeating_only&quot;</span>
                                                <span class="p">)</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>
                                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                            <span class="s2">&quot;[GFK][prepass] owner=</span><span class="si">%s</span><span class="s2"> element=</span><span class="si">%s</span><span class="s2"> policy=</span><span class="si">%s</span><span class="s2"> distinct_children=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
                                            <span class="n">owner_name</span><span class="p">,</span>
                                            <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                            <span class="n">reason</span><span class="p">,</span>
                                            <span class="nb">len</span><span class="p">(</span><span class="n">distinct_child_types</span><span class="p">),</span>
                                        <span class="p">)</span>
                                    <span class="c1"># Exclude polymorphic children under this wrapper from concrete generation</span>
                                    <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">is_list</span> <span class="ow">and</span> <span class="n">repeating_leaf_child</span><span class="p">:</span>
                                        <span class="n">excluded_child_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">repeating_leaf_child</span><span class="p">)</span>
                                    <span class="c1"># Also exclude distinct child complex types observed under the wrapper</span>
                                    <span class="n">excluded_child_types</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">distinct_child_types</span> <span class="k">if</span> <span class="n">t</span><span class="p">})</span>
                    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="s2">&quot;[GFK][prepass] Failed while processing schema &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="n">schema_def</span><span class="p">,</span> <span class="s2">&quot;schema_location&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">),</span>
                            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="p">)</span>
                        <span class="k">continue</span>  <span class="c1"># best-effort per schema</span>

                <span class="c1"># Filter discovery output to remove excluded children, keeping wrappers/parents</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="c1"># filtered_models is a mapping of qualname -&gt; complex_type</span>
                    <span class="n">fm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="p">,</span> <span class="s2">&quot;filtered_models&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{})</span>
                    <span class="k">if</span> <span class="n">fm</span> <span class="ow">and</span> <span class="n">excluded_child_types</span><span class="p">:</span>
                        <span class="n">new_fm</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fm</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_child_types</span><span class="p">}</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span> <span class="o">=</span> <span class="n">new_fm</span>  <span class="c1"># type: ignore[attr-defined]</span>
                        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                <span class="s2">&quot;[GFK][prepass] excluded_children_count=</span><span class="si">%d</span><span class="s2"> (examples: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                                <span class="nb">len</span><span class="p">(</span><span class="n">excluded_child_types</span><span class="p">),</span>
                                <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">excluded_child_types</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]),</span>
                            <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;[GFK][prepass] Failed to filter excluded children: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

                <span class="c1"># Share exclusions and owner marks with the field factory for intra-model decisions</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;field_factory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">ff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">ff</span><span class="o">.</span><span class="n">_gfk_excluded_child_types</span> <span class="o">=</span> <span class="n">excluded_child_types</span>
                        <span class="c1"># Seed owner names to suppress JSON placeholders for wrapper children</span>
                        <span class="n">owner_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;_gfk_owner_names&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">()))</span>
                        <span class="n">owner_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gfk_owner_wrappers</span><span class="p">)</span>
                        <span class="n">ff</span><span class="o">.</span><span class="n">_gfk_owner_names</span> <span class="o">=</span> <span class="n">owner_names</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;[GFK][prepass] Failed to share state with field factory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="c1"># Prepass is best-effort and should never crash generation</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;[GFK][prepass] Unexpected error: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Conflict guard: if GFK owners detected but JSON relationship styles are requested, fail fast.</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_gfk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;field_factory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">owners</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;_gfk_owner_names&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">())</span>
            <span class="n">list_style</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;list_relationship_style&quot;</span><span class="p">,</span> <span class="s2">&quot;child_fk&quot;</span><span class="p">)</span>
            <span class="n">nested_style</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;nested_relationship_strategy&quot;</span><span class="p">,</span> <span class="s2">&quot;fk&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">owners</span> <span class="ow">and</span> <span class="p">(</span><span class="n">list_style</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span> <span class="ow">or</span> <span class="n">nested_style</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;GFK mode active with owners detected, but JSON relationship strategy was requested. &quot;</span>
                    <span class="s2">&quot;This configuration would produce dual emission. Adjust flags or disable JSON strategy.&quot;</span>
                <span class="p">)</span>
        <span class="c1"># Inform the field factory which models are actually included so it can</span>
        <span class="c1"># avoid generating relations to filtered-out models (fallback to JSON).</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Prefer local (unqualified) complex type names to match factory lookups</span>
            <span class="c1"># filtered_models keys may be qualified as &quot;{namespace}.{name}&quot;, so derive plain names</span>
            <span class="n">included_local_names</span> <span class="o">=</span> <span class="p">{</span>
                <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="p">}</span>
            <span class="c1"># Also include any already-qualified keys for maximum compatibility</span>
            <span class="n">included_qualified_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined]</span>
            <span class="n">included_names</span> <span class="o">=</span> <span class="n">included_local_names</span> <span class="o">|</span> <span class="n">included_qualified_keys</span>
            <span class="c1"># type: ignore[attr-defined]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">field_factory</span><span class="o">.</span><span class="n">included_model_names</span> <span class="o">=</span> <span class="n">included_names</span>  <span class="c1"># noqa: E501</span>
            <span class="c1"># Also pass through any GFK prepass exclusions to the field factory if not already set</span>
            <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">field_factory</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;_gfk_excluded_child_types&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="n">ff</span><span class="o">.</span><span class="n">_gfk_excluded_child_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Failed to inform field factory about included models or defaults: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">models_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_models_in_processing_order</span><span class="p">()</span>

        <span class="c1"># Classify models for Timescale usage (hypertable vs dimension)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_timescale</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span> <span class="o">=</span> <span class="n">classify_xml_complex_types</span><span class="p">(</span>
                    <span class="n">models_to_process</span><span class="p">,</span>
                    <span class="n">overrides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timescale_overrides</span><span class="p">,</span>
                    <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timescale_config</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Timescale classification failed; proceeding without roles: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Strict validation: if any hypertable lacks a direct time-like field, fail fast</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_timescale</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_strict</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models_to_process</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">TimescaleRole</span><span class="o">.</span><span class="n">HYPERTABLE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_direct_time_feature</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Timescale strict mode: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; classified as hypertable but has no direct time-like field. &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Add a time/timestamp-like attribute/element or demote via overrides.&quot;</span>
                    <span class="p">)</span>

        <span class="c1"># Reset state for this run (mirror BaseStaticGenerator)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">extra_type_imports</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">pydantic_imports</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">context_class_imports</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">imported_names</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">processed_field_types</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">_add_type_import</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">source_model</span> <span class="ow">in</span> <span class="n">models_to_process</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">setup_django_model</span><span class="p">(</span><span class="n">source_model</span><span class="p">)</span>

        <span class="c1"># Give the factory a chance to add cross-model relationship fields (e.g., child FKs)</span>
        <span class="n">carriers_by_name</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span> <span class="n">c</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">django_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;finalize_relationships&quot;</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># type: ignore[attr-defined]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">finalize_relationships</span><span class="p">(</span><span class="n">carriers_by_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error finalizing XML relationships: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Inject GenericRelation on parents when GFK is enabled and pending children exist</span>
        <span class="n">gfk_used</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="p">,</span> <span class="s2">&quot;enable_gfk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="p">,</span> <span class="s2">&quot;pending_gfk_children&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                    <span class="c1"># Ensure contenttypes imports</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.fields&quot;</span><span class="p">,</span> <span class="s2">&quot;GenericRelation&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.fields&quot;</span><span class="p">,</span> <span class="s2">&quot;GenericForeignKey&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.models&quot;</span><span class="p">,</span> <span class="s2">&quot;ContentType&quot;</span><span class="p">)</span>
                    <span class="c1"># Add reverse relation field on parent model</span>
                    <span class="n">carrier</span><span class="o">.</span><span class="n">django_field_definitions</span><span class="p">[</span>
                        <span class="s2">&quot;entries&quot;</span>
                    <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GenericRelation(&#39;GenericEntry&#39;, related_query_name=&#39;entries&#39;)&quot;</span>
                    <span class="n">gfk_used</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed while injecting GenericRelation/GenericEntry fields: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Optional diagnostics: summarize GFK routing per parent</span>
        <span class="k">if</span> <span class="n">gfk_used</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">summary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="p">,</span> <span class="s2">&quot;pending_gfk_children&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
                        <span class="n">owner</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                        <span class="n">summary</span><span class="p">[</span><span class="n">owner</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">summary</span><span class="p">:</span>
                    <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GFK] Routed children counts by owner: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to summarize GFK routing: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="c1"># Register generated model classes for in-memory lookup by ingestors</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">register_generated_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                        <span class="s2">&quot;Registered generated model </span><span class="si">%s</span><span class="s2"> (abstract=</span><span class="si">%s</span><span class="s2">) for app &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                        <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;abstract&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="c1"># Prevent dynamic classes from polluting Django&#39;s global app registry</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="kn">from</span><span class="w"> </span><span class="nn">django.apps</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                            <span class="n">apps</span> <span class="k">as</span> <span class="n">django_apps</span><span class="p">,</span>  <span class="c1"># Local import to avoid hard dependency</span>
                        <span class="p">)</span>

                        <span class="n">model_lower</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">model_lower</span><span class="p">:</span>
                            <span class="n">django_apps</span><span class="o">.</span><span class="n">all_models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">model_lower</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                        <span class="c1"># Best-effort cleanup only, but log for visibility</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clean up Django global app registry: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Non-fatal: failed to register generated models for app &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Proceed with standard definition rendering</span>
        <span class="n">model_definitions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">django_model_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">model_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_model_definition</span><span class="p">(</span><span class="n">carrier</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">model_def</span><span class="p">:</span>
                        <span class="n">model_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_def</span><span class="p">)</span>
                        <span class="n">django_model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_clean_generic_type</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Error generating definition for source model </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># If GFK used, append GenericEntry model definition and include in __all__</span>
        <span class="k">if</span> <span class="n">gfk_used</span><span class="p">:</span>
            <span class="n">model_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_generic_entry_model_definition</span><span class="p">())</span>
            <span class="n">django_model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&#39;GenericEntry&#39;&quot;</span><span class="p">)</span>

        <span class="n">unique_model_definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deduplicate_definitions</span><span class="p">(</span><span class="n">model_definitions</span><span class="p">)</span>
        <span class="c1"># Ensure that every advertised model name in __all__ has a corresponding class definition.</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_re</span>

            <span class="n">joined_defs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_model_definitions</span><span class="p">)</span>
            <span class="n">existing_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*class\s+(\w+)\(&quot;</span><span class="p">,</span> <span class="n">joined_defs</span><span class="p">,</span> <span class="n">_re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)}</span>
            <span class="n">advertised_names</span> <span class="o">=</span> <span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_clean_generic_type</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">django_model</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span>
                <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">django_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">advertised_names</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_names</span><span class="p">:</span>
                    <span class="n">minimal_def</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="sa">f</span><span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">Django model for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                        <span class="sa">f</span><span class="s2">&quot;class </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">    # No fields defined for this model.</span><span class="se">\n</span><span class="s2">    pass</span><span class="se">\n\n</span><span class="s2">    class Meta:</span><span class="se">\n</span><span class="s2">        app_label = &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">        abstract = False</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="n">unique_model_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minimal_def</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Failed to ensure all advertised model names have definitions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">exc</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">deduplicate_imports</span><span class="p">()</span>
        <span class="n">template_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_template_context</span><span class="p">(</span><span class="n">unique_model_definitions</span><span class="p">,</span> <span class="n">django_model_names</span><span class="p">,</span> <span class="n">imports</span><span class="p">)</span>
        <span class="n">template_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;generation_timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
                <span class="s2">&quot;base_model_module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
                <span class="s2">&quot;base_model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                <span class="s2">&quot;extra_type_imports&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">extra_type_imports</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="c1"># Detect validator usage to ensure imports are present</span>
        <span class="n">used_validators</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="c1"># Primary source: field factory tracking</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">field_factory</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;field_factory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="n">factory_used</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_factory</span><span class="p">,</span> <span class="s2">&quot;used_validators&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">factory_used</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
                <span class="n">used_validators</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">factory_used</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to collect validator usage from field factory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># Fallback: scan rendered definitions</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">used_validators</span><span class="p">:</span>
                <span class="n">validator_symbols</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="s2">&quot;RegexValidator&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;MinValueValidator&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;MaxValueValidator&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;URLValidator&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;EmailValidator&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_slug&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_uuid4&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_email&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_ipv46_address&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_ipv4_address&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_ipv6_address&quot;</span><span class="p">,</span>
                    <span class="s2">&quot;validate_unicode_slug&quot;</span><span class="p">,</span>
                <span class="p">]</span>
                <span class="n">joined_defs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_model_definitions</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">validator_symbols</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span><span class="si">}</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span> <span class="n">joined_defs</span><span class="p">):</span>
                        <span class="n">used_validators</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to scan rendered definitions for validator usage: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">template_context</span><span class="p">[</span><span class="s2">&quot;validator_imports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">used_validators</span><span class="p">)</span>
        <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;models_file.py.j2&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">template_context</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_build_generic_entry_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build the GenericEntry model definition string for XMLSchema generation.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.fields&quot;</span><span class="p">,</span> <span class="s2">&quot;GenericForeignKey&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.fields&quot;</span><span class="p">,</span> <span class="s2">&quot;GenericRelation&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.models&quot;</span><span class="p">,</span> <span class="s2">&quot;ContentType&quot;</span><span class="p">)</span>

        <span class="n">fields</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;content_type = models.ForeignKey(&#39;contenttypes.ContentType&#39;, on_delete=models.CASCADE)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;object_id = models.PositiveIntegerField()&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;content_object = GenericForeignKey(&#39;content_type&#39;, &#39;object_id&#39;)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;element_qname = models.CharField(max_length=255)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;type_qname = models.CharField(max_length=255, null=True, blank=True)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;attrs_json = models.JSONField(default=dict, blank=True)&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_value_mode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;typed_columns&quot;</span><span class="p">:</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;text_value = models.TextField(null=True, blank=True)&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;num_value = models.DecimalField(max_digits=20, decimal_places=6, null=True, blank=True)&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;time_value = models.DateTimeField(null=True, blank=True)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;order_index = models.IntegerField(default=0)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;path_hint = models.CharField(max_length=255, null=True, blank=True)&quot;</span><span class="p">)</span>

        <span class="n">indexes_lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;models.Index(fields=[&#39;content_type&#39;, &#39;object_id&#39;])&quot;</span><span class="p">]</span>
        <span class="c1"># Optional indexes when typed value columns are enabled</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_value_mode&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;typed_columns&quot;</span><span class="p">:</span>
            <span class="n">indexes_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;models.Index(fields=[&#39;element_qname&#39;])&quot;</span><span class="p">)</span>
            <span class="n">indexes_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;models.Index(fields=[&#39;type_qname&#39;])&quot;</span><span class="p">)</span>
            <span class="n">indexes_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;models.Index(fields=[&#39;time_value&#39;])&quot;</span><span class="p">)</span>
            <span class="n">indexes_lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;models.Index(fields=[&#39;content_type&#39;, &#39;object_id&#39;, &#39;-time_value&#39;])&quot;</span><span class="p">)</span>

        <span class="n">lines</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;class GenericEntry(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;    class Meta:&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;        app_label = &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        abstract = False&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        indexes = [&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">indexes_lines</span><span class="p">:</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;            </span><span class="si">{</span><span class="n">idx</span><span class="si">}</span><span class="s2">,&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;        ]&quot;</span><span class="p">)</span>
        <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>

    <span class="c1"># Override to choose Timescale base per model and pass roles map to factory</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">setup_django_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_model</span><span class="p">:</span> <span class="n">XmlSchemaComplexType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConversionCarrier</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># type: ignore[override]</span>
        <span class="n">source_model_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">source_model</span><span class="p">)))</span>
        <span class="n">use_ts_base</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_timescale</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">use_ts_base</span> <span class="o">=</span> <span class="n">should_use_timescale_base</span><span class="p">(</span><span class="n">source_model_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                <span class="n">use_ts_base</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="n">base_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">use_ts_base</span><span class="p">:</span>
            <span class="n">base_class</span> <span class="o">=</span> <span class="n">XmlTimescaleBase</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">base_class</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span>

        <span class="n">carrier</span> <span class="o">=</span> <span class="n">ConversionCarrier</span><span class="p">(</span>
            <span class="n">source_model</span><span class="o">=</span><span class="n">source_model</span><span class="p">,</span>
            <span class="n">meta_app_label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
            <span class="n">base_django_model</span><span class="o">=</span><span class="n">base_class</span><span class="p">,</span>
            <span class="n">class_name_prefix</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">class_name_prefix</span><span class="p">,</span>
            <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">enable_gfk</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enable_gfk</span><span class="p">,</span>
            <span class="n">gfk_policy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gfk_policy</span><span class="p">,</span>
            <span class="n">gfk_threshold_children</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gfk_threshold_children</span><span class="p">,</span>
            <span class="n">gfk_value_mode</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gfk_value_mode</span><span class="p">,</span>
            <span class="n">gfk_normalize_common_attrs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gfk_normalize_common_attrs</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Make roles map available to field factory for FK decisions</span>
        <span class="n">carrier</span><span class="o">.</span><span class="n">context_data</span><span class="p">[</span><span class="s2">&quot;_timescale_roles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">make_django_model</span><span class="p">(</span><span class="n">carrier</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">carrier</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">carrier</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s2">&quot;Error creating Django model for </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">source_model_name</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_write_to_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">schema_files</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s1">&#39;generated_models.py&#39;</span><span class="p">,</span> <span class="n">app_label</span><span class="o">=</span><span class="s1">&#39;xmlschema_app&#39;</span><span class="p">,</span> <span class="n">filter_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">module_mappings</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">class_name_prefix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">nested_relationship_strategy</span><span class="o">=</span><span class="s1">&#39;fk&#39;</span><span class="p">,</span> <span class="n">list_relationship_style</span><span class="o">=</span><span class="s1">&#39;child_fk&#39;</span><span class="p">,</span> <span class="n">nesting_depth_threshold</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">base_model_class</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">enable_timescale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timescale_overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timescale_config</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">timescale_strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">auto_generate_missing_leaves</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">enable_gfk</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">gfk_policy</span><span class="o">=</span><span class="s1">&#39;threshold_by_children&#39;</span><span class="p">,</span> <span class="n">gfk_threshold_children</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">gfk_value_mode</span><span class="o">=</span><span class="s1">&#39;typed_columns&#39;</span><span class="p">,</span> <span class="n">gfk_normalize_common_attrs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gfk_overrides</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.__init__" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a XML Schema â†’ Django generator with optional Generic Entries mode.</p>
<p>GFK (Generic Entries) flags:
- enable_gfk: Enable Generic Entries mode. When True and policy matches, parents
  gain <code>entries = GenericRelation('GenericEntry')</code> and concrete children are not emitted.
- gfk_policy: Controls which nested elements are routed to GenericEntry.
  Values: "substitution_only" | "repeating_only" | "all_nested" | "threshold_by_children".
- gfk_threshold_children: Used only with "threshold_by_children"; minimum distinct child
  complex types inside a wrapper-like container to activate GFK.
- gfk_value_mode: "json_only" stores text under attrs_json['value']; "typed_columns"
  extracts text into text_value, num_value, time_value when unambiguous.
- gfk_normalize_common_attrs: Reserved (default False) for promoting frequently used
  attributes (e.g., timestamp) into normalized columns when using typed columns.
- gfk_overrides: Optional per-element overrides by local element name;
  True forces GFK, False disables it even if the policy would apply.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">schema_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span>
    <span class="n">output_path</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;generated_models.py&quot;</span><span class="p">,</span>
    <span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;xmlschema_app&quot;</span><span class="p">,</span>
    <span class="n">filter_function</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">XmlSchemaComplexType</span><span class="p">],</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">module_mappings</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">class_name_prefix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="c1"># Relationship handling for nested complex types</span>
    <span class="n">nested_relationship_strategy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;fk&quot;</span><span class="p">,</span>  <span class="c1"># one of: &quot;fk&quot;, &quot;json&quot;, &quot;auto&quot;</span>
    <span class="n">list_relationship_style</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;child_fk&quot;</span><span class="p">,</span>  <span class="c1"># one of: &quot;child_fk&quot;, &quot;m2m&quot;, &quot;json&quot;</span>
    <span class="n">nesting_depth_threshold</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="c1"># Optional override for the Django base model class</span>
    <span class="n">base_model_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Feature flags</span>
    <span class="n">enable_timescale</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="c1"># Timescale configuration</span>
    <span class="n">timescale_overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TimescaleRole</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timescale_config</span><span class="p">:</span> <span class="n">TimescaleConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">timescale_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># Control behavior for missing leaf/child targets in finalize pass</span>
    <span class="n">auto_generate_missing_leaves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="c1"># --- GFK flags ---</span>
    <span class="n">enable_gfk</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">gfk_policy</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;threshold_by_children&quot;</span><span class="p">,</span>
    <span class="n">gfk_threshold_children</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
    <span class="n">gfk_value_mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="s2">&quot;typed_columns&quot;</span><span class="p">,</span>
    <span class="n">gfk_normalize_common_attrs</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">gfk_overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a XML Schema â†’ Django generator with optional Generic Entries mode.</span>

<span class="sd">    GFK (Generic Entries) flags:</span>
<span class="sd">    - enable_gfk: Enable Generic Entries mode. When True and policy matches, parents</span>
<span class="sd">      gain `entries = GenericRelation(&#39;GenericEntry&#39;)` and concrete children are not emitted.</span>
<span class="sd">    - gfk_policy: Controls which nested elements are routed to GenericEntry.</span>
<span class="sd">      Values: &quot;substitution_only&quot; | &quot;repeating_only&quot; | &quot;all_nested&quot; | &quot;threshold_by_children&quot;.</span>
<span class="sd">    - gfk_threshold_children: Used only with &quot;threshold_by_children&quot;; minimum distinct child</span>
<span class="sd">      complex types inside a wrapper-like container to activate GFK.</span>
<span class="sd">    - gfk_value_mode: &quot;json_only&quot; stores text under attrs_json[&#39;value&#39;]; &quot;typed_columns&quot;</span>
<span class="sd">      extracts text into text_value, num_value, time_value when unambiguous.</span>
<span class="sd">    - gfk_normalize_common_attrs: Reserved (default False) for promoting frequently used</span>
<span class="sd">      attributes (e.g., timestamp) into normalized columns when using typed columns.</span>
<span class="sd">    - gfk_overrides: Optional per-element overrides by local element name;</span>
<span class="sd">      True forces GFK, False disables it even if the policy would apply.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">discovery</span> <span class="o">=</span> <span class="n">XmlSchemaDiscovery</span><span class="p">()</span>
    <span class="n">model_factory</span> <span class="o">=</span> <span class="n">XmlSchemaModelFactory</span><span class="p">(</span>
        <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">,</span>
        <span class="n">nested_relationship_strategy</span><span class="o">=</span><span class="n">nested_relationship_strategy</span><span class="p">,</span>
        <span class="n">list_relationship_style</span><span class="o">=</span><span class="n">list_relationship_style</span><span class="p">,</span>
        <span class="n">nesting_depth_threshold</span><span class="o">=</span><span class="n">nesting_depth_threshold</span><span class="p">,</span>
        <span class="n">enable_gfk</span><span class="o">=</span><span class="n">enable_gfk</span><span class="p">,</span>
        <span class="n">gfk_policy</span><span class="o">=</span><span class="n">gfk_policy</span><span class="p">,</span>
        <span class="n">gfk_threshold_children</span><span class="o">=</span><span class="n">gfk_threshold_children</span><span class="p">,</span>
        <span class="n">gfk_overrides</span><span class="o">=</span><span class="n">gfk_overrides</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
        <span class="n">output_path</span><span class="o">=</span><span class="n">output_path</span><span class="p">,</span>
        <span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">schema_files</span><span class="p">],</span>
        <span class="n">app_label</span><span class="o">=</span><span class="n">app_label</span><span class="p">,</span>
        <span class="n">discovery_instance</span><span class="o">=</span><span class="n">discovery</span><span class="p">,</span>
        <span class="n">model_factory_instance</span><span class="o">=</span><span class="n">model_factory</span><span class="p">,</span>
        <span class="n">base_model_class</span><span class="o">=</span><span class="n">base_model_class</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_default_base_model_class</span><span class="p">(),</span>
        <span class="n">class_name_prefix</span><span class="o">=</span><span class="n">class_name_prefix</span><span class="p">,</span>
        <span class="n">module_mappings</span><span class="o">=</span><span class="n">module_mappings</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="n">filter_function</span><span class="o">=</span><span class="n">filter_function</span><span class="p">,</span>
        <span class="n">enable_timescale</span><span class="o">=</span><span class="n">enable_timescale</span><span class="p">,</span>
        <span class="n">enable_gfk</span><span class="o">=</span><span class="n">enable_gfk</span><span class="p">,</span>
        <span class="n">gfk_policy</span><span class="o">=</span><span class="n">gfk_policy</span><span class="p">,</span>
        <span class="n">gfk_threshold_children</span><span class="o">=</span><span class="n">gfk_threshold_children</span><span class="p">,</span>
        <span class="n">gfk_value_mode</span><span class="o">=</span><span class="n">gfk_value_mode</span><span class="p">,</span>
        <span class="n">gfk_normalize_common_attrs</span><span class="o">=</span><span class="n">gfk_normalize_common_attrs</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># Timescale classification results cached per run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TimescaleRole</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_overrides</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">TimescaleRole</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">timescale_overrides</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_config</span><span class="p">:</span> <span class="n">TimescaleConfig</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="n">timescale_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_strict</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">timescale_strict</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_auto_generate_missing_leaves</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">auto_generate_missing_leaves</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.from_schema_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">from_schema_files</span><span class="p">(</span><span class="n">schema_files</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.from_schema_files" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convenience class method to create generator from schema files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>schema_files</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span> | <span title="pathlib.Path">Path</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of XSD file paths</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional arguments passed to <strong>init</strong></p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><a class="autorefs autorefs-internal" title="XmlSchemaDjangoModelGenerator (pydantic2django.xmlschema.generator.XmlSchemaDjangoModelGenerator)" href="generator/#pydantic2django.xmlschema.generator.XmlSchemaDjangoModelGenerator">XmlSchemaDjangoModelGenerator</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Configured XmlSchemaDjangoModelGenerator instance</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">from_schema_files</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">schema_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;XmlSchemaDjangoModelGenerator&quot;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Convenience class method to create generator from schema files.</span>

<span class="sd">    Args:</span>
<span class="sd">        schema_files: List of XSD file paths</span>
<span class="sd">        **kwargs: Additional arguments passed to __init__</span>

<span class="sd">    Returns:</span>
<span class="sd">        Configured XmlSchemaDjangoModelGenerator instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">schema_files</span><span class="o">=</span><span class="n">schema_files</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate</span><span class="p">()</span></code>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Main method to generate the Django models file.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main method to generate the Django models file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Starting Django model generation to </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># The base class now handles the full generation pipeline</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">generate</span><span class="p">()</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully generated Django models in </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate_models_file" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_models_file</span><span class="p">()</span></code>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate_models_file" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Override to allow relationship finalization after carriers are built
but before rendering templates.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_models_file</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Override to allow relationship finalization after carriers are built</span>
<span class="sd">    but before rendering templates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Discover and create carriers first via base implementation pieces</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">discover_models</span><span class="p">()</span>
    <span class="c1"># --- GFK Prepass: when enabled, identify wrapper owners and exclude their polymorphic children ---</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_gfk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_policy&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">excluded_child_types</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">gfk_owner_wrappers</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
            <span class="n">policy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_policy&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="n">threshold_val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;gfk_threshold_children&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">)</span>
            <span class="c1"># Walk parsed schemas to infer wrapper owners and their child types</span>
            <span class="k">for</span> <span class="n">schema_def</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="p">,</span> <span class="s2">&quot;parsed_schemas&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">get_all_complex_types</span><span class="p">():</span>
                        <span class="c1"># Iterate elements of each complex type</span>
                        <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">ct</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                            <span class="c1"># Only interested in complex targets</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">el</span><span class="o">.</span><span class="n">type_name</span> <span class="ow">or</span> <span class="n">el</span><span class="o">.</span><span class="n">base_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="n">target_type</span> <span class="o">=</span> <span class="n">el</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">target_ct</span> <span class="o">=</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">complex_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target_type</span><span class="p">)</span>
                            <span class="k">if</span> <span class="ow">not</span> <span class="n">target_ct</span><span class="p">:</span>
                                <span class="k">continue</span>
                            <span class="c1"># Wrapper-like heuristic (may be used by providers; structural checks take precedence)</span>
                            <span class="n">_is_wrapper_like</span> <span class="o">=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">target_type</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span>
                                <span class="s2">&quot;WrapperType&quot;</span>
                            <span class="p">)</span>
                            <span class="c1"># Collect distinct child complex types under target wrapper</span>
                            <span class="n">distinct_child_types</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
                            <span class="n">has_substitution_members</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">repeating_leaf_child</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                            <span class="k">for</span> <span class="n">child_el</span> <span class="ow">in</span> <span class="n">target_ct</span><span class="o">.</span><span class="n">elements</span><span class="p">:</span>
                                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;substitution_group&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                    <span class="n">has_substitution_members</span> <span class="o">=</span> <span class="kc">True</span>
                                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;type_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                    <span class="n">cand</span> <span class="o">=</span> <span class="n">child_el</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                                    <span class="k">if</span> <span class="n">cand</span><span class="p">:</span>
                                        <span class="n">distinct_child_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">cand</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;is_list&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">child_el</span><span class="p">,</span> <span class="s2">&quot;type_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                                    <span class="n">repeating_leaf_child</span> <span class="o">=</span> <span class="n">child_el</span><span class="o">.</span><span class="n">type_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                            <span class="c1"># Decide based on policy (favor generic structural checks over name heuristics)</span>
                            <span class="n">route_by_subst</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;substitution_only&quot;</span> <span class="ow">and</span> <span class="n">has_substitution_members</span>
                            <span class="n">route_by_all_nested</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;all_nested&quot;</span>
                            <span class="n">route_by_threshold</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;threshold_by_children&quot;</span> <span class="ow">and</span> <span class="p">(</span>
                                <span class="n">threshold_val</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">distinct_child_types</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">threshold_val</span>
                            <span class="p">)</span>
                            <span class="n">route_by_repeating</span> <span class="o">=</span> <span class="n">policy</span> <span class="o">==</span> <span class="s2">&quot;repeating_only&quot;</span> <span class="ow">and</span> <span class="nb">bool</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">is_list</span><span class="p">)</span>

                            <span class="k">if</span> <span class="n">route_by_subst</span> <span class="ow">or</span> <span class="n">route_by_all_nested</span> <span class="ow">or</span> <span class="n">route_by_threshold</span> <span class="ow">or</span> <span class="n">route_by_repeating</span><span class="p">:</span>
                                <span class="c1"># Mark the CURRENT complex type (container) as the owner so placeholders on it are suppressed</span>
                                <span class="k">try</span><span class="p">:</span>
                                    <span class="n">owner_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ct</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ct</span><span class="p">))</span>
                                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                                    <span class="n">owner_name</span> <span class="o">=</span> <span class="n">target_type</span>
                                <span class="n">gfk_owner_wrappers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">owner_name</span><span class="p">)</span>
                                <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                                    <span class="n">reason</span> <span class="o">=</span> <span class="p">(</span>
                                        <span class="s2">&quot;substitution_only&quot;</span>
                                        <span class="k">if</span> <span class="n">route_by_subst</span>
                                        <span class="k">else</span> <span class="p">(</span>
                                            <span class="s2">&quot;all_nested&quot;</span>
                                            <span class="k">if</span> <span class="n">route_by_all_nested</span>
                                            <span class="k">else</span> <span class="p">(</span>
                                                <span class="s2">&quot;threshold_by_children&quot;</span> <span class="k">if</span> <span class="n">route_by_threshold</span> <span class="k">else</span> <span class="s2">&quot;repeating_only&quot;</span>
                                            <span class="p">)</span>
                                        <span class="p">)</span>
                                    <span class="p">)</span>
                                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                                        <span class="s2">&quot;[GFK][prepass] owner=</span><span class="si">%s</span><span class="s2"> element=</span><span class="si">%s</span><span class="s2"> policy=</span><span class="si">%s</span><span class="s2"> distinct_children=</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span>
                                        <span class="n">owner_name</span><span class="p">,</span>
                                        <span class="n">el</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                                        <span class="n">reason</span><span class="p">,</span>
                                        <span class="nb">len</span><span class="p">(</span><span class="n">distinct_child_types</span><span class="p">),</span>
                                    <span class="p">)</span>
                                <span class="c1"># Exclude polymorphic children under this wrapper from concrete generation</span>
                                <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">is_list</span> <span class="ow">and</span> <span class="n">repeating_leaf_child</span><span class="p">:</span>
                                    <span class="n">excluded_child_types</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">repeating_leaf_child</span><span class="p">)</span>
                                <span class="c1"># Also exclude distinct child complex types observed under the wrapper</span>
                                <span class="n">excluded_child_types</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">t</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">distinct_child_types</span> <span class="k">if</span> <span class="n">t</span><span class="p">})</span>
                <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;[GFK][prepass] Failed while processing schema &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">schema_def</span><span class="p">,</span> <span class="s2">&quot;schema_location&quot;</span><span class="p">,</span> <span class="s2">&quot;?&quot;</span><span class="p">),</span>
                        <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="k">continue</span>  <span class="c1"># best-effort per schema</span>

            <span class="c1"># Filter discovery output to remove excluded children, keeping wrappers/parents</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># filtered_models is a mapping of qualname -&gt; complex_type</span>
                <span class="n">fm</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="p">,</span> <span class="s2">&quot;filtered_models&quot;</span><span class="p">,</span> <span class="p">{})</span> <span class="ow">or</span> <span class="p">{})</span>
                <span class="k">if</span> <span class="n">fm</span> <span class="ow">and</span> <span class="n">excluded_child_types</span><span class="p">:</span>
                    <span class="n">new_fm</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">fm</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">excluded_child_types</span><span class="p">}</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span> <span class="o">=</span> <span class="n">new_fm</span>  <span class="c1"># type: ignore[attr-defined]</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                            <span class="s2">&quot;[GFK][prepass] excluded_children_count=</span><span class="si">%d</span><span class="s2"> (examples: </span><span class="si">%s</span><span class="s2">)&quot;</span><span class="p">,</span>
                            <span class="nb">len</span><span class="p">(</span><span class="n">excluded_child_types</span><span class="p">),</span>
                            <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">excluded_child_types</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]),</span>
                        <span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;[GFK][prepass] Failed to filter excluded children: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Share exclusions and owner marks with the field factory for intra-model decisions</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">ff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;field_factory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ff</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">_gfk_excluded_child_types</span> <span class="o">=</span> <span class="n">excluded_child_types</span>
                    <span class="c1"># Seed owner names to suppress JSON placeholders for wrapper children</span>
                    <span class="n">owner_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;_gfk_owner_names&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">()))</span>
                    <span class="n">owner_names</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">gfk_owner_wrappers</span><span class="p">)</span>
                    <span class="n">ff</span><span class="o">.</span><span class="n">_gfk_owner_names</span> <span class="o">=</span> <span class="n">owner_names</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;[GFK][prepass] Failed to share state with field factory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="c1"># Prepass is best-effort and should never crash generation</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;[GFK][prepass] Unexpected error: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Conflict guard: if GFK owners detected but JSON relationship styles are requested, fail fast.</span>
    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;enable_gfk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;field_factory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">owners</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;_gfk_owner_names&quot;</span><span class="p">,</span> <span class="nb">set</span><span class="p">())</span> <span class="ow">or</span> <span class="nb">set</span><span class="p">())</span>
        <span class="n">list_style</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;list_relationship_style&quot;</span><span class="p">,</span> <span class="s2">&quot;child_fk&quot;</span><span class="p">)</span>
        <span class="n">nested_style</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;nested_relationship_strategy&quot;</span><span class="p">,</span> <span class="s2">&quot;fk&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">owners</span> <span class="ow">and</span> <span class="p">(</span><span class="n">list_style</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span> <span class="ow">or</span> <span class="n">nested_style</span> <span class="o">==</span> <span class="s2">&quot;json&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;GFK mode active with owners detected, but JSON relationship strategy was requested. &quot;</span>
                <span class="s2">&quot;This configuration would produce dual emission. Adjust flags or disable JSON strategy.&quot;</span>
            <span class="p">)</span>
    <span class="c1"># Inform the field factory which models are actually included so it can</span>
    <span class="c1"># avoid generating relations to filtered-out models (fallback to JSON).</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Prefer local (unqualified) complex type names to match factory lookups</span>
        <span class="c1"># filtered_models keys may be qualified as &quot;{namespace}.{name}&quot;, so derive plain names</span>
        <span class="n">included_local_names</span> <span class="o">=</span> <span class="p">{</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span><span class="o">.</span><span class="n">values</span><span class="p">()</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="p">}</span>
        <span class="c1"># Also include any already-qualified keys for maximum compatibility</span>
        <span class="n">included_qualified_keys</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># type: ignore[attr-defined]</span>
        <span class="n">included_names</span> <span class="o">=</span> <span class="n">included_local_names</span> <span class="o">|</span> <span class="n">included_qualified_keys</span>
        <span class="c1"># type: ignore[attr-defined]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">field_factory</span><span class="o">.</span><span class="n">included_model_names</span> <span class="o">=</span> <span class="n">included_names</span>  <span class="c1"># noqa: E501</span>
        <span class="c1"># Also pass through any GFK prepass exclusions to the field factory if not already set</span>
        <span class="n">ff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">field_factory</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">ff</span><span class="p">,</span> <span class="s2">&quot;_gfk_excluded_child_types&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">ff</span><span class="o">.</span><span class="n">_gfk_excluded_child_types</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Failed to inform field factory about included models or defaults: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="n">models_to_process</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_models_in_processing_order</span><span class="p">()</span>

    <span class="c1"># Classify models for Timescale usage (hypertable vs dimension)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_timescale</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span> <span class="o">=</span> <span class="n">classify_xml_complex_types</span><span class="p">(</span>
                <span class="n">models_to_process</span><span class="p">,</span>
                <span class="n">overrides</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timescale_overrides</span><span class="p">,</span>
                <span class="n">config</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_timescale_config</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Timescale classification failed; proceeding without roles: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Strict validation: if any hypertable lacks a direct time-like field, fail fast</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_timescale</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_strict</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">models_to_process</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">m</span><span class="p">)))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_timescale_roles</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">==</span> <span class="n">TimescaleRole</span><span class="o">.</span><span class="n">HYPERTABLE</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">has_direct_time_feature</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Timescale strict mode: &#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">&#39; classified as hypertable but has no direct time-like field. &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Add a time/timestamp-like attribute/element or demote via overrides.&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Reset state for this run (mirror BaseStaticGenerator)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">extra_type_imports</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">pydantic_imports</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">context_class_imports</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">imported_names</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">processed_field_types</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">_add_type_import</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">source_model</span> <span class="ow">in</span> <span class="n">models_to_process</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_django_model</span><span class="p">(</span><span class="n">source_model</span><span class="p">)</span>

    <span class="c1"># Give the factory a chance to add cross-model relationship fields (e.g., child FKs)</span>
    <span class="n">carriers_by_name</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)):</span> <span class="n">c</span>
        <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">django_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;finalize_relationships&quot;</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># type: ignore[attr-defined]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="o">.</span><span class="n">finalize_relationships</span><span class="p">(</span><span class="n">carriers_by_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">)</span>  <span class="c1"># noqa: E501</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error finalizing XML relationships: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Inject GenericRelation on parents when GFK is enabled and pending children exist</span>
    <span class="n">gfk_used</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="p">,</span> <span class="s2">&quot;enable_gfk&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="p">,</span> <span class="s2">&quot;pending_gfk_children&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
                <span class="c1"># Ensure contenttypes imports</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.fields&quot;</span><span class="p">,</span> <span class="s2">&quot;GenericRelation&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.fields&quot;</span><span class="p">,</span> <span class="s2">&quot;GenericForeignKey&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">add_import</span><span class="p">(</span><span class="s2">&quot;django.contrib.contenttypes.models&quot;</span><span class="p">,</span> <span class="s2">&quot;ContentType&quot;</span><span class="p">)</span>
                <span class="c1"># Add reverse relation field on parent model</span>
                <span class="n">carrier</span><span class="o">.</span><span class="n">django_field_definitions</span><span class="p">[</span>
                    <span class="s2">&quot;entries&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;GenericRelation(&#39;GenericEntry&#39;, related_query_name=&#39;entries&#39;)&quot;</span>
                <span class="n">gfk_used</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed while injecting GenericRelation/GenericEntry fields: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Optional diagnostics: summarize GFK routing per parent</span>
    <span class="k">if</span> <span class="n">gfk_used</span> <span class="ow">and</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">summary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="p">,</span> <span class="s2">&quot;pending_gfk_children&quot;</span><span class="p">,</span> <span class="p">[])</span> <span class="ow">or</span> <span class="p">[]:</span>
                    <span class="n">owner</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">entry</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;owner&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                    <span class="n">summary</span><span class="p">[</span><span class="n">owner</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">owner</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">summary</span><span class="p">:</span>
                <span class="n">details</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">items</span><span class="p">()))</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GFK] Routed children counts by owner: </span><span class="si">{</span><span class="n">details</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to summarize GFK routing: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Register generated model classes for in-memory lookup by ingestors</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">register_generated_model</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                    <span class="s2">&quot;Registered generated model </span><span class="si">%s</span><span class="s2"> (abstract=</span><span class="si">%s</span><span class="s2">) for app &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span><span class="p">,</span>
                    <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;abstract&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="c1"># Prevent dynamic classes from polluting Django&#39;s global app registry</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">from</span><span class="w"> </span><span class="nn">django.apps</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
                        <span class="n">apps</span> <span class="k">as</span> <span class="n">django_apps</span><span class="p">,</span>  <span class="c1"># Local import to avoid hard dependency</span>
                    <span class="p">)</span>

                    <span class="n">model_lower</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">,</span> <span class="s2">&quot;_meta&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">model_lower</span><span class="p">:</span>
                        <span class="n">django_apps</span><span class="o">.</span><span class="n">all_models</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">model_lower</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
                    <span class="c1"># Best-effort cleanup only, but log for visibility</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to clean up Django global app registry: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Non-fatal: failed to register generated models for app &#39;</span><span class="si">%s</span><span class="s2">&#39;: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="p">,</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Proceed with standard definition rendering</span>
    <span class="n">model_definitions</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">django_model_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">carrier</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">model_def</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_model_definition</span><span class="p">(</span><span class="n">carrier</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">model_def</span><span class="p">:</span>
                    <span class="n">model_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model_def</span><span class="p">)</span>
                    <span class="n">django_model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_clean_generic_type</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">django_model</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Error generating definition for source model </span><span class="si">{</span><span class="nb">getattr</span><span class="p">(</span><span class="n">carrier</span><span class="o">.</span><span class="n">source_model</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;__name__&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;?&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1"># If GFK used, append GenericEntry model definition and include in __all__</span>
    <span class="k">if</span> <span class="n">gfk_used</span><span class="p">:</span>
        <span class="n">model_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_build_generic_entry_model_definition</span><span class="p">())</span>
        <span class="n">django_model_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&#39;GenericEntry&#39;&quot;</span><span class="p">)</span>

    <span class="n">unique_model_definitions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_deduplicate_definitions</span><span class="p">(</span><span class="n">model_definitions</span><span class="p">)</span>
    <span class="c1"># Ensure that every advertised model name in __all__ has a corresponding class definition.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">_re</span>

        <span class="n">joined_defs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_model_definitions</span><span class="p">)</span>
        <span class="n">existing_names</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">_re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^\s*class\s+(\w+)\(&quot;</span><span class="p">,</span> <span class="n">joined_defs</span><span class="p">,</span> <span class="n">_re</span><span class="o">.</span><span class="n">MULTILINE</span><span class="p">)}</span>
        <span class="n">advertised_names</span> <span class="o">=</span> <span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_clean_generic_type</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">django_model</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">carriers</span>
            <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">django_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="p">]</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">advertised_names</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">existing_names</span><span class="p">:</span>
                <span class="n">minimal_def</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;&quot;&quot;&quot;</span><span class="se">\n</span><span class="s1">Django model for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="s1">&quot;&quot;&quot;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
                    <span class="sa">f</span><span class="s2">&quot;class </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">):</span><span class="se">\n</span><span class="s2">    # No fields defined for this model.</span><span class="se">\n</span><span class="s2">    pass</span><span class="se">\n\n</span><span class="s2">    class Meta:</span><span class="se">\n</span><span class="s2">        app_label = &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">app_label</span><span class="si">}</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">        abstract = False</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="n">unique_model_definitions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">minimal_def</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Failed to ensure all advertised model names have definitions: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">exc</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">imports</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">deduplicate_imports</span><span class="p">()</span>
    <span class="n">template_context</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prepare_template_context</span><span class="p">(</span><span class="n">unique_model_definitions</span><span class="p">,</span> <span class="n">django_model_names</span><span class="p">,</span> <span class="n">imports</span><span class="p">)</span>
    <span class="n">template_context</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;generation_timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y-%m-</span><span class="si">%d</span><span class="s2"> %H:%M:%S&quot;</span><span class="p">),</span>
            <span class="s2">&quot;base_model_module&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
            <span class="s2">&quot;base_model_name&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_model_class</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span>
            <span class="s2">&quot;extra_type_imports&quot;</span><span class="p">:</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">import_handler</span><span class="o">.</span><span class="n">extra_type_imports</span><span class="p">),</span>
        <span class="p">}</span>
    <span class="p">)</span>
    <span class="c1"># Detect validator usage to ensure imports are present</span>
    <span class="n">used_validators</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
    <span class="c1"># Primary source: field factory tracking</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">field_factory</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model_factory_instance</span><span class="p">,</span> <span class="s2">&quot;field_factory&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">factory_used</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field_factory</span><span class="p">,</span> <span class="s2">&quot;used_validators&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">factory_used</span><span class="p">,</span> <span class="nb">set</span><span class="p">):</span>
            <span class="n">used_validators</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">factory_used</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to collect validator usage from field factory: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># Fallback: scan rendered definitions</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">used_validators</span><span class="p">:</span>
            <span class="n">validator_symbols</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;RegexValidator&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MinValueValidator&quot;</span><span class="p">,</span>
                <span class="s2">&quot;MaxValueValidator&quot;</span><span class="p">,</span>
                <span class="s2">&quot;URLValidator&quot;</span><span class="p">,</span>
                <span class="s2">&quot;EmailValidator&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_slug&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_uuid4&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_email&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_ipv46_address&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_ipv4_address&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_ipv6_address&quot;</span><span class="p">,</span>
                <span class="s2">&quot;validate_unicode_slug&quot;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">joined_defs</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">unique_model_definitions</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">symbol</span> <span class="ow">in</span> <span class="n">validator_symbols</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">rf</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">b</span><span class="si">{</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span><span class="si">}</span><span class="se">\\</span><span class="s2">b&quot;</span><span class="p">,</span> <span class="n">joined_defs</span><span class="p">):</span>
                    <span class="n">used_validators</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">symbol</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">exc</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Failed to scan rendered definitions for validator usage: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">exc</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">template_context</span><span class="p">[</span><span class="s2">&quot;validator_imports&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">used_validators</span><span class="p">)</span>
    <span class="n">template</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">jinja_env</span><span class="o">.</span><span class="n">get_template</span><span class="p">(</span><span class="s2">&quot;models_file.py.j2&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">template</span><span class="o">.</span><span class="n">render</span><span class="p">(</span><span class="o">**</span><span class="n">template_context</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate_models_with_xml_metadata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_models_with_xml_metadata</span><span class="p">()</span></code>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.generate_models_with_xml_metadata" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate Django models with additional XML metadata.</p>
<p>This method extends the base generate() to add XML-specific
comments and metadata to the generated models.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_models_with_xml_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate Django models with additional XML metadata.</span>

<span class="sd">    This method extends the base generate() to add XML-specific</span>
<span class="sd">    comments and metadata to the generated models.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_models_file</span><span class="p">()</span>

    <span class="c1"># Add XML Schema file references as comments at the top</span>
    <span class="n">schema_files_comment</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;# Generated from XML Schema: </span><span class="si">{</span><span class="n">schema_file</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">schema_file</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">schema_files</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Insert after the initial comments</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">content</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">insert_index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:]:</span>  <span class="c1"># Single line docstring</span>
            <span class="n">insert_index</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">break</span>
        <span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&quot;&#39;</span><span class="p">):</span>  <span class="c1"># Multi-line docstring start</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
                <span class="k">if</span> <span class="s1">&#39;&quot;&quot;&quot;&#39;</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
                    <span class="n">insert_index</span> <span class="o">=</span> <span class="n">j</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="k">break</span>
            <span class="k">break</span>

    <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_index</span><span class="p">,</span> <span class="n">schema_files_comment</span><span class="p">)</span>
    <span class="n">lines</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">insert_index</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.get_schema_statistics" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_schema_statistics</span><span class="p">()</span></code>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.get_schema_statistics" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get statistics about the parsed schemas.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_schema_statistics</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get statistics about the parsed schemas.&quot;&quot;&quot;</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;total_schemas&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">),</span>
        <span class="s2">&quot;total_complex_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">all_models</span><span class="p">),</span>
        <span class="s2">&quot;filtered_complex_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">filtered_models</span><span class="p">),</span>
        <span class="s2">&quot;generated_models&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">carriers</span><span class="p">),</span>
    <span class="p">}</span>

    <span class="c1"># Add per-schema breakdown</span>
    <span class="n">schema_breakdown</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">schema_def</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">:</span>
        <span class="n">schema_breakdown</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;schema_location&quot;</span><span class="p">:</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">schema_location</span><span class="p">,</span>
                <span class="s2">&quot;target_namespace&quot;</span><span class="p">:</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">,</span>
                <span class="s2">&quot;complex_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">schema_def</span><span class="o">.</span><span class="n">complex_types</span><span class="p">),</span>
                <span class="s2">&quot;simple_types&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">schema_def</span><span class="o">.</span><span class="n">simple_types</span><span class="p">),</span>
                <span class="s2">&quot;elements&quot;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">schema_def</span><span class="o">.</span><span class="n">elements</span><span class="p">),</span>
            <span class="p">}</span>
        <span class="p">)</span>

    <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;schema_breakdown&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">schema_breakdown</span>
    <span class="k">return</span> <span class="n">stats</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.validate_schemas" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">validate_schemas</span><span class="p">()</span></code>

<a href="#pydantic2django.xmlschema.XmlSchemaDjangoModelGenerator.validate_schemas" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Validate the parsed schemas and return any warnings or errors.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of validation messages</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/generator.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">validate_schemas</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Validate the parsed schemas and return any warnings or errors.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List of validation messages</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">schema_def</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">discovery_instance</span><span class="o">.</span><span class="n">parsed_schemas</span><span class="p">:</span>
        <span class="c1"># Check for common issues</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">target_namespace</span><span class="p">:</span>
            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Schema </span><span class="si">{</span><span class="n">schema_def</span><span class="o">.</span><span class="n">schema_location</span><span class="si">}</span><span class="s2"> has no target namespace&quot;</span><span class="p">)</span>

        <span class="c1"># Check for name conflicts</span>
        <span class="n">all_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">complex_type</span> <span class="ow">in</span> <span class="n">schema_def</span><span class="o">.</span><span class="n">complex_types</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">complex_type</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">all_names</span><span class="p">:</span>
                <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Duplicate type name: </span><span class="si">{</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">all_names</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">complex_type</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">messages</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h2 id="pydantic2django.xmlschema.get_generated_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_generated_model</span><span class="p">(</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.get_generated_model" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Retrieve a previously registered model class, if available.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_generated_model</span><span class="p">(</span><span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve a previously registered model class, if available.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_GENERATED_MODELS_REGISTRY</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">app_label</span><span class="p">,</span> <span class="p">{})</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="pydantic2django.xmlschema.register_generated_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">register_generated_model</span><span class="p">(</span><span class="n">app_label</span><span class="p">,</span> <span class="n">model_class</span><span class="p">)</span></code>

<a href="#pydantic2django.xmlschema.register_generated_model" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Register a dynamically created Django model class for later lookup.</p>
<p>This does not touch Django's app registry; it merely stores a reference
so that tools can resolve classes by (app_label, model_name) when needed.</p>


            <details class="quote">
              <summary>Source code in <code>src/pydantic2django/xmlschema/__init__.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">register_generated_model</span><span class="p">(</span><span class="n">app_label</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_class</span><span class="p">:</span> <span class="nb">type</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Register a dynamically created Django model class for later lookup.</span>

<span class="sd">    This does not touch Django&#39;s app registry; it merely stores a reference</span>
<span class="sd">    so that tools can resolve classes by (app_label, model_name) when needed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">model_class</span><span class="p">,</span> <span class="s2">&quot;__name__&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">model_class</span><span class="p">)</span>
    <span class="n">bucket</span> <span class="o">=</span> <span class="n">_GENERATED_MODELS_REGISTRY</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">app_label</span><span class="p">,</span> <span class="p">{})</span>
    <span class="n">bucket</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_class</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>







  
  






                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top", "navigation.sections", "navigation.instant", "navigation.tracking", "navigation.expand", "navigation.path", "search.suggest", "search.highlight", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.integrate", "toc.follow", "search.share"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>